#define _GNU_SOURCE

#include "util.h"

#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <stdio.h>
#include <inttypes.h>
#include <string.h>
#include <err.h>
#include <sysexits.h>
#include <glob.h>
#include <string.h>
#include <htslib/kstring.h>

#include "unity.h"
#include "bpt.h"
#include "giggle_index.h"
#include "lists.h"
#include "file_read.h"
#include "wah.h"
#include "ll.h"
#include "jsw_avltree.h"
#include "pq.h"

#define MIN(X, Y) (((X) < (Y)) ? (X) : (Y))
#define MAX(X, Y) (((X) > (Y)) ? (X) : (Y))


void setUp(void) { }
void tearDown(void) { }

//{{{ void test_offset_index_add_no_data(void)
void test_offset_index_add_no_data(void)
{ 
    //{{{ uint32_t A_offsets[1000] = 
    uint32_t A_offsets[1000] = {0, 61, 118, 173, 230, 292, 350, 412, 476, 534,
        599, 661, 726, 784, 841, 899, 964, 1026, 1085, 1145, 1204, 1267, 1330,
        1388, 1447, 1508, 1566, 1627, 1686, 1747, 1810, 1873, 1935, 1992, 2050,
        2108, 2167, 2226, 2285, 2344, 2401, 2460, 2519, 2578, 2636, 2702, 2766,
        2826, 2886, 2947, 3009, 3069, 3128, 3188, 3248, 3312, 3375, 3441, 3499,
        3559, 3622, 3683, 3746, 3804, 3863, 3922, 3983, 4043, 4104, 4164, 4225,
        4285, 4352, 4413, 4480, 4544, 4607, 4668, 4729, 4792, 4853, 4917, 4978,
        5037, 5101, 5161, 5218, 5285, 5346, 5409, 5465, 5526, 5583, 5645, 5706,
        5767, 5827, 5887, 5950, 6010, 6069, 6133, 6193, 6254, 6316, 6375, 6435,
        6494, 6557, 6616, 6676, 6736, 6796, 6855, 6915, 6975, 7033, 7092, 7158,
        7218, 7277, 7337, 7397, 7455, 7518, 7577, 7637, 7701, 7761, 7822, 7885,
        7951, 8016, 8078, 8140, 8202, 8264, 8326, 8388, 8453, 8513, 8575, 8636,
        8698, 8752, 8810, 8868, 8926, 8985, 9043, 9103, 9162, 9222, 9282, 9341,
        9401, 9461, 9524, 9583, 9641, 9700, 9762, 9822, 9882, 9945, 10008,
        10065, 10128, 10188, 10248, 10308, 10370, 10427, 10487, 10547, 10606,
        10665, 10726, 10788, 10853, 10914, 10976, 11039, 11104, 11168, 11229,
        11291, 11355, 11413, 11470, 11525, 11584, 11641, 11698, 11755, 11815,
        11877, 11936, 11999, 12058, 12120, 12184, 12244, 12304, 12364, 12427,
        12491, 12549, 12610, 12674, 12738, 12803, 12869, 12929, 12990, 13049,
        13111, 13171, 13233, 13296, 13356, 13416, 13480, 13539, 13599, 13663,
        13725, 13787, 13851, 13913, 13978, 14044, 14105, 14166, 14226, 14288,
        14351, 14411, 14471, 14530, 14589, 14651, 14715, 14773, 14832, 14893,
        14957, 15016, 15075, 15135, 15194, 15253, 15313, 15373, 15432, 15491,
        15550, 15610, 15670, 15731, 15790, 15848, 15910, 15970, 16033, 16092,
        16156, 16216, 16276, 16335, 16392, 16452, 16511, 16569, 16628, 16686,
        16746, 16804, 16870, 16932, 16993, 17055, 17116, 17176, 17235, 17297,
        17357, 17415, 17474, 17537, 17596, 17656, 17717, 17779, 17839, 17899,
        17958, 18018, 18079, 18138, 18200, 18259, 18317, 18376, 18439, 18503,
        18566, 18625, 18687, 18748, 18808, 18870, 18931, 18991, 19054, 19115,
        19175, 19234, 19296, 19358, 19417, 19475, 19536, 19596, 19658, 19716,
        19776, 19837, 19899, 19958, 20016, 20073, 20137, 20203, 20262, 20321,
        20382, 20441, 20504, 20564, 20629, 20688, 20747, 20806, 20865, 20923,
        20982, 21041, 21103, 21164, 21222, 21285, 21341, 21398, 21457, 21516,
        21575, 21634, 21694, 21757, 21822, 21881, 21941, 22000, 22059, 22123,
        22181, 22239, 22297, 22355, 22411, 22470, 22531, 22595, 22654, 22715,
        22778, 22839, 22898, 22956, 23016, 23080, 23140, 23199, 23259, 23319,
        23382, 23445, 23504, 23564, 23626, 23693, 23757, 23816, 23876, 23936,
        23996, 24055, 24113, 24172, 24232, 24293, 24353, 24415, 24474, 24536,
        24594, 24653, 24712, 24776, 24840, 24896, 24956, 25012, 25069, 25128,
        25184, 25244, 25303, 25364, 25424, 25487, 25546, 25606, 25664, 25722,
        25784, 25843, 25902, 25962, 26021, 26079, 26138, 26200, 26259, 26321,
        26382, 26443, 26505, 26563, 26620, 26682, 26738, 26798, 26856, 26915,
        26975, 27036, 27098, 27158, 27221, 27283, 27343, 27406, 27466, 27525,
        27587, 27646, 27705, 27767, 27828, 27887, 27947, 28006, 28065, 28131,
        28191, 28254, 28314, 28372, 28431, 28491, 28551, 28615, 28681, 28741,
        28800, 28859, 28919, 28978, 29038, 29104, 29165, 29225, 29287, 29344,
        29401, 29458, 29519, 29578, 29636, 29695, 29754, 29812, 29871, 29934,
        29996, 30057, 30116, 30174, 30233, 30291, 30352, 30411, 30473, 30531,
        30592, 30652, 30716, 30775, 30834, 30896, 30959, 31016, 31074, 31133,
        31194, 31254, 31317, 31376, 31436, 31497, 31558, 31618, 31678, 31739,
        31802, 31865, 31928, 31988, 32048, 32106, 32167, 32231, 32290, 32355,
        32414, 32474, 32534, 32599, 32660, 32721, 32781, 32842, 32905, 32966,
        33027, 33090, 33151, 33213, 33278, 33338, 33399, 33460, 33520, 33578,
        33639, 33699, 33759, 33819, 33878, 33941, 34001, 34065, 34125, 34185,
        34245, 34304, 34362, 34421, 34487, 34546, 34605, 34664, 34724, 34787,
        34846, 34905, 34967, 35027, 35089, 35148, 35207, 35267, 35329, 35389,
        35451, 35511, 35570, 35630, 35691, 35755, 35814, 35873, 35935, 35998,
        36064, 36124, 36183, 36247, 36310, 36369, 36430, 36489, 36551, 36611,
        36670, 36730, 36790, 36850, 36914, 36974, 37033, 37093, 37152, 37210,
        37269, 37327, 37390, 37455, 37512, 37571, 37631, 37687, 37743, 37806,
        37864, 37922, 37985, 38043, 38102, 38164, 38223, 38280, 38341, 38399,
        38461, 38522, 38583, 38642, 38700, 38760, 38822, 38882, 38940, 38999,
        39064, 39124, 39185, 39248, 39309, 39369, 39434, 39495, 39556, 39616,
        39680, 39741, 39802, 39862, 39925, 39990, 40052, 40116, 40177, 40237,
        40298, 40359, 40418, 40479, 40540, 40599, 40665, 40726, 40787, 40850,
        40914, 40970, 41027, 41085, 41141, 41202, 41260, 41322, 41379, 41438,
        41498, 41552, 41614, 41677, 41738, 41797, 41860, 41918, 41975, 42032,
        42091, 42150, 42209, 42267, 42329, 42387, 42448, 42509, 42569, 42630,
        42690, 42751, 42814, 42874, 42934, 42995, 43059, 43119, 43182, 43245,
        43304, 43366, 43430, 43486, 43544, 43602, 43661, 43718, 43777, 43836,
        43895, 43953, 44014, 44073, 44132, 44190, 44249, 44312, 44369, 44431,
        44489, 44548, 44609, 44674, 44735, 44797, 44858, 44919, 44984, 45045,
        45103, 45168, 45228, 45290, 45349, 45412, 45475, 45538, 45598, 45659,
        45719, 45784, 45847, 45910, 45971, 46032, 46093, 46157, 46218, 46280,
        46344, 46405, 46465, 46526, 46590, 46650, 46714, 46774, 46833, 46893,
        46953, 47017, 47077, 47131, 47186, 47245, 47305, 47361, 47420, 47476,
        47533, 47588, 47647, 47706, 47765, 47824, 47883, 47942, 48003, 48061,
        48121, 48180, 48239, 48298, 48360, 48422, 48478, 48536, 48598, 48663,
        48724, 48785, 48844, 48908, 48967, 49026, 49086, 49145, 49204, 49263,
        49325, 49383, 49443, 49506, 49570, 49630, 49691, 49751, 49812, 49873,
        49933, 49996, 50063, 50127, 50188, 50249, 50309, 50370, 50430, 50490,
        50551, 50605, 50658, 50712, 50769, 50827, 50887, 50943, 51003, 51066,
        51125, 51183, 51242, 51303, 51361, 51419, 51481, 51539, 51598, 51657,
        51715, 51778, 51836, 51894, 51955, 52013, 52074, 52137, 52201, 52265,
        52325, 52387, 52451, 52515, 52574, 52641, 52701, 52764, 52824, 52884,
        52947, 53006, 53070, 53131, 53192, 53254, 53314, 53376, 53439, 53498,
        53556, 53617, 53682, 53745, 53806, 53866, 53925, 53987, 54048, 54108,
        54169, 54232, 54297, 54356, 54413, 54468, 54525, 54588, 54646, 54704,
        54766, 54829, 54890, 54949, 55012, 55072, 55129, 55187, 55250, 55307,
        55365, 55423, 55482, 55540, 55598, 55659, 55716, 55775, 55833, 55890,
        55948, 56006, 56071, 56133, 56194, 56254, 56314, 56374, 56435, 56496,
        56560, 56621, 56681, 56742, 56800, 56863, 56926, 56985, 57043, 57101,
        57163, 57223, 57285, 57342, 57403, 57466, 57523, 57581, 57641, 57698,
        57759, 57820, 57879, 57937, 57998, 58063, 58126, 58183, 58244, 58305,
        58365, 58428, 58489, 58549, 58610, 58672, 58733, 58793, 58853, 58918,
        58982, 59044, 59104, 59164, 59225, 59286, 59347, 59404, 59460, 59522,
        59581, 59637, 59698, 59760, 59823, 59883, 59944, 60007, 60068, 60127,
        60187, 60249, 60310, 60372};
    //}}}

    char *file_name = "../data/many/2.1.bed.gz";
    struct input_file *i = input_file_init(file_name);

    int chrm_len = 10;
    char *chrm = (char *)malloc(chrm_len*sizeof(char));
    uint32_t start, end;
    long offset;
    kstring_t line = {0, 0, NULL};

    struct offset_index *offset_idx = 
            offset_index_init(100,
                              "tmp.test_offset_index_add");
    uint32_t intrv_id;
    TEST_ASSERT_EQUAL(on_disk, offset_idx->type);

    while (i->input_file_get_next_interval(i,
                                           &chrm,
                                           &chrm_len,
                                           &start,
                                           &end,
                                           &offset,
                                           &line) >= 0) {
        intrv_id = offset_index_add(offset_idx,
                                    offset,
                                    &line,
                                    1);

    }
    fprintf(stderr, "\n");

    TEST_ASSERT_EQUAL(1000, offset_idx->index->num);
    
    uint32_t j;
    for (j = 0; j < 1000; ++j)
        TEST_ASSERT_EQUAL(A_offsets[j], 
                          OFFSET_INDEX_PAIR(offset_idx, j)->offset);

    offset_index_store(offset_idx);

    offset_index_destroy(&offset_idx);


    if (line.s != NULL)
        free(line.s);
    input_file_destroy(&i);
    free(chrm);

    offset_idx = offset_index_load("tmp.test_offset_index_add");
    TEST_ASSERT_EQUAL(on_disk, offset_idx->type);

    for (j = 0; j < 1000; ++j)
        TEST_ASSERT_EQUAL(A_offsets[j], 
                          OFFSET_INDEX_PAIR(offset_idx, j)->offset);

    offset_index_destroy(&offset_idx);
}
//}}}

//{{{ void test_offset_index_add_data(void)
struct offset_data_append_data_test_struct
{
    uint32_t data;
};

void offset_data_append_data_test_func(uint8_t *dest, kstring_t *line)
{
    int n;
    int *fields = ksplit(line, '\t', &n);

    struct offset_data_append_data_test_struct a;
    a.data = atoi(line->s + fields[4]);

    memcpy(dest, &a, sizeof(struct offset_data_append_data_test_struct));

    free(fields);
}

void test_offset_index_add_data(void)
{ 
    //{{{ uint32_t A_offsets[1000] = 
    uint32_t A_offsets[1000] = {0, 61, 118, 173, 230, 292, 350, 412, 476, 534,
        599, 661, 726, 784, 841, 899, 964, 1026, 1085, 1145, 1204, 1267, 1330,
        1388, 1447, 1508, 1566, 1627, 1686, 1747, 1810, 1873, 1935, 1992, 2050,
        2108, 2167, 2226, 2285, 2344, 2401, 2460, 2519, 2578, 2636, 2702, 2766,
        2826, 2886, 2947, 3009, 3069, 3128, 3188, 3248, 3312, 3375, 3441, 3499,
        3559, 3622, 3683, 3746, 3804, 3863, 3922, 3983, 4043, 4104, 4164, 4225,
        4285, 4352, 4413, 4480, 4544, 4607, 4668, 4729, 4792, 4853, 4917, 4978,
        5037, 5101, 5161, 5218, 5285, 5346, 5409, 5465, 5526, 5583, 5645, 5706,
        5767, 5827, 5887, 5950, 6010, 6069, 6133, 6193, 6254, 6316, 6375, 6435,
        6494, 6557, 6616, 6676, 6736, 6796, 6855, 6915, 6975, 7033, 7092, 7158,
        7218, 7277, 7337, 7397, 7455, 7518, 7577, 7637, 7701, 7761, 7822, 7885,
        7951, 8016, 8078, 8140, 8202, 8264, 8326, 8388, 8453, 8513, 8575, 8636,
        8698, 8752, 8810, 8868, 8926, 8985, 9043, 9103, 9162, 9222, 9282, 9341,
        9401, 9461, 9524, 9583, 9641, 9700, 9762, 9822, 9882, 9945, 10008,
        10065, 10128, 10188, 10248, 10308, 10370, 10427, 10487, 10547, 10606,
        10665, 10726, 10788, 10853, 10914, 10976, 11039, 11104, 11168, 11229,
        11291, 11355, 11413, 11470, 11525, 11584, 11641, 11698, 11755, 11815,
        11877, 11936, 11999, 12058, 12120, 12184, 12244, 12304, 12364, 12427,
        12491, 12549, 12610, 12674, 12738, 12803, 12869, 12929, 12990, 13049,
        13111, 13171, 13233, 13296, 13356, 13416, 13480, 13539, 13599, 13663,
        13725, 13787, 13851, 13913, 13978, 14044, 14105, 14166, 14226, 14288,
        14351, 14411, 14471, 14530, 14589, 14651, 14715, 14773, 14832, 14893,
        14957, 15016, 15075, 15135, 15194, 15253, 15313, 15373, 15432, 15491,
        15550, 15610, 15670, 15731, 15790, 15848, 15910, 15970, 16033, 16092,
        16156, 16216, 16276, 16335, 16392, 16452, 16511, 16569, 16628, 16686,
        16746, 16804, 16870, 16932, 16993, 17055, 17116, 17176, 17235, 17297,
        17357, 17415, 17474, 17537, 17596, 17656, 17717, 17779, 17839, 17899,
        17958, 18018, 18079, 18138, 18200, 18259, 18317, 18376, 18439, 18503,
        18566, 18625, 18687, 18748, 18808, 18870, 18931, 18991, 19054, 19115,
        19175, 19234, 19296, 19358, 19417, 19475, 19536, 19596, 19658, 19716,
        19776, 19837, 19899, 19958, 20016, 20073, 20137, 20203, 20262, 20321,
        20382, 20441, 20504, 20564, 20629, 20688, 20747, 20806, 20865, 20923,
        20982, 21041, 21103, 21164, 21222, 21285, 21341, 21398, 21457, 21516,
        21575, 21634, 21694, 21757, 21822, 21881, 21941, 22000, 22059, 22123,
        22181, 22239, 22297, 22355, 22411, 22470, 22531, 22595, 22654, 22715,
        22778, 22839, 22898, 22956, 23016, 23080, 23140, 23199, 23259, 23319,
        23382, 23445, 23504, 23564, 23626, 23693, 23757, 23816, 23876, 23936,
        23996, 24055, 24113, 24172, 24232, 24293, 24353, 24415, 24474, 24536,
        24594, 24653, 24712, 24776, 24840, 24896, 24956, 25012, 25069, 25128,
        25184, 25244, 25303, 25364, 25424, 25487, 25546, 25606, 25664, 25722,
        25784, 25843, 25902, 25962, 26021, 26079, 26138, 26200, 26259, 26321,
        26382, 26443, 26505, 26563, 26620, 26682, 26738, 26798, 26856, 26915,
        26975, 27036, 27098, 27158, 27221, 27283, 27343, 27406, 27466, 27525,
        27587, 27646, 27705, 27767, 27828, 27887, 27947, 28006, 28065, 28131,
        28191, 28254, 28314, 28372, 28431, 28491, 28551, 28615, 28681, 28741,
        28800, 28859, 28919, 28978, 29038, 29104, 29165, 29225, 29287, 29344,
        29401, 29458, 29519, 29578, 29636, 29695, 29754, 29812, 29871, 29934,
        29996, 30057, 30116, 30174, 30233, 30291, 30352, 30411, 30473, 30531,
        30592, 30652, 30716, 30775, 30834, 30896, 30959, 31016, 31074, 31133,
        31194, 31254, 31317, 31376, 31436, 31497, 31558, 31618, 31678, 31739,
        31802, 31865, 31928, 31988, 32048, 32106, 32167, 32231, 32290, 32355,
        32414, 32474, 32534, 32599, 32660, 32721, 32781, 32842, 32905, 32966,
        33027, 33090, 33151, 33213, 33278, 33338, 33399, 33460, 33520, 33578,
        33639, 33699, 33759, 33819, 33878, 33941, 34001, 34065, 34125, 34185,
        34245, 34304, 34362, 34421, 34487, 34546, 34605, 34664, 34724, 34787,
        34846, 34905, 34967, 35027, 35089, 35148, 35207, 35267, 35329, 35389,
        35451, 35511, 35570, 35630, 35691, 35755, 35814, 35873, 35935, 35998,
        36064, 36124, 36183, 36247, 36310, 36369, 36430, 36489, 36551, 36611,
        36670, 36730, 36790, 36850, 36914, 36974, 37033, 37093, 37152, 37210,
        37269, 37327, 37390, 37455, 37512, 37571, 37631, 37687, 37743, 37806,
        37864, 37922, 37985, 38043, 38102, 38164, 38223, 38280, 38341, 38399,
        38461, 38522, 38583, 38642, 38700, 38760, 38822, 38882, 38940, 38999,
        39064, 39124, 39185, 39248, 39309, 39369, 39434, 39495, 39556, 39616,
        39680, 39741, 39802, 39862, 39925, 39990, 40052, 40116, 40177, 40237,
        40298, 40359, 40418, 40479, 40540, 40599, 40665, 40726, 40787, 40850,
        40914, 40970, 41027, 41085, 41141, 41202, 41260, 41322, 41379, 41438,
        41498, 41552, 41614, 41677, 41738, 41797, 41860, 41918, 41975, 42032,
        42091, 42150, 42209, 42267, 42329, 42387, 42448, 42509, 42569, 42630,
        42690, 42751, 42814, 42874, 42934, 42995, 43059, 43119, 43182, 43245,
        43304, 43366, 43430, 43486, 43544, 43602, 43661, 43718, 43777, 43836,
        43895, 43953, 44014, 44073, 44132, 44190, 44249, 44312, 44369, 44431,
        44489, 44548, 44609, 44674, 44735, 44797, 44858, 44919, 44984, 45045,
        45103, 45168, 45228, 45290, 45349, 45412, 45475, 45538, 45598, 45659,
        45719, 45784, 45847, 45910, 45971, 46032, 46093, 46157, 46218, 46280,
        46344, 46405, 46465, 46526, 46590, 46650, 46714, 46774, 46833, 46893,
        46953, 47017, 47077, 47131, 47186, 47245, 47305, 47361, 47420, 47476,
        47533, 47588, 47647, 47706, 47765, 47824, 47883, 47942, 48003, 48061,
        48121, 48180, 48239, 48298, 48360, 48422, 48478, 48536, 48598, 48663,
        48724, 48785, 48844, 48908, 48967, 49026, 49086, 49145, 49204, 49263,
        49325, 49383, 49443, 49506, 49570, 49630, 49691, 49751, 49812, 49873,
        49933, 49996, 50063, 50127, 50188, 50249, 50309, 50370, 50430, 50490,
        50551, 50605, 50658, 50712, 50769, 50827, 50887, 50943, 51003, 51066,
        51125, 51183, 51242, 51303, 51361, 51419, 51481, 51539, 51598, 51657,
        51715, 51778, 51836, 51894, 51955, 52013, 52074, 52137, 52201, 52265,
        52325, 52387, 52451, 52515, 52574, 52641, 52701, 52764, 52824, 52884,
        52947, 53006, 53070, 53131, 53192, 53254, 53314, 53376, 53439, 53498,
        53556, 53617, 53682, 53745, 53806, 53866, 53925, 53987, 54048, 54108,
        54169, 54232, 54297, 54356, 54413, 54468, 54525, 54588, 54646, 54704,
        54766, 54829, 54890, 54949, 55012, 55072, 55129, 55187, 55250, 55307,
        55365, 55423, 55482, 55540, 55598, 55659, 55716, 55775, 55833, 55890,
        55948, 56006, 56071, 56133, 56194, 56254, 56314, 56374, 56435, 56496,
        56560, 56621, 56681, 56742, 56800, 56863, 56926, 56985, 57043, 57101,
        57163, 57223, 57285, 57342, 57403, 57466, 57523, 57581, 57641, 57698,
        57759, 57820, 57879, 57937, 57998, 58063, 58126, 58183, 58244, 58305,
        58365, 58428, 58489, 58549, 58610, 58672, 58733, 58793, 58853, 58918,
        58982, 59044, 59104, 59164, 59225, 59286, 59347, 59404, 59460, 59522,
        59581, 59637, 59698, 59760, 59823, 59883, 59944, 60007, 60068, 60127,
        60187, 60249, 60310, 60372};
    //}}}

    //{{{uint32_t A_data[1000] = 
    uint32_t A_data[1000] = {1000, 453, 421, 506, 1000, 426, 1000, 1000, 531,
        1000, 1000, 1000, 490, 397, 497, 1000, 1000, 606, 680, 604, 1000, 1000,
        534, 482, 692, 448, 893, 494, 670, 1000, 1000, 1000, 487, 565, 472,
        427, 613, 552, 577, 371, 638, 422, 478, 397, 1000, 1000, 459, 429, 603,
        630, 429, 426, 443, 380, 752, 768, 1000, 440, 422, 933, 537, 876, 386,
        415, 379, 481, 415, 556, 409, 579, 473, 1000, 442, 1000, 1000, 905,
        496, 392, 856, 489, 1000, 427, 415, 1000, 382, 408, 1000, 523, 973,
        408, 1000, 453, 1000, 1000, 1000, 545, 517, 1000, 402, 370, 1000, 495,
        945, 1000, 482, 430, 414, 1000, 465, 581, 499, 375, 468, 501, 538, 378,
        443, 1000, 490, 524, 477, 517, 437, 1000, 397, 370, 1000, 416, 473,
        993, 1000, 801, 592, 535, 433, 531, 386, 393, 1000, 385, 385, 378, 403,
        388, 918, 1000, 956, 795, 408, 488, 378, 464, 418, 595, 502, 459, 919,
        596, 385, 448, 931, 617, 497, 772, 754, 385, 1000, 646, 441, 515, 712,
        379, 410, 597, 371, 420, 872, 719, 1000, 410, 410, 973, 1000, 732, 403,
        470, 719, 1000, 400, 436, 552, 386, 389, 393, 373, 788, 371, 1000, 397,
        896, 1000, 380, 526, 372, 937, 1000, 373, 964, 1000, 1000, 1000, 1000,
        419, 689, 373, 888, 406, 1000, 1000, 423, 592, 1000, 423, 523, 995,
        383, 473, 795, 472, 654, 1000, 391, 402, 407, 461, 1000, 395, 424, 407,
        378, 872, 1000, 378, 479, 503, 1000, 400, 380, 380, 389, 370, 509, 371,
        393, 378, 444, 436, 478, 424, 383, 393, 986, 472, 1000, 483, 1000, 380,
        373, 516, 371, 481, 380, 407, 430, 378, 580, 373, 1000, 502, 415, 419,
        380, 483, 382, 656, 517, 423, 391, 692, 395, 538, 699, 706, 422, 405,
        372, 569, 841, 508, 1000, 436, 424, 439, 1000, 1000, 1000, 424, 785,
        646, 580, 724, 640, 427, 1000, 1000, 448, 466, 554, 422, 1000, 772,
        717, 744, 1000, 578, 499, 914, 694, 380, 402, 393, 1000, 1000, 461,
        380, 646, 490, 1000, 495, 1000, 525, 436, 414, 393, 371, 509, 530, 668,
        643, 375, 756, 393, 491, 490, 493, 408, 524, 567, 1000, 1000, 556, 511,
        452, 465, 1000, 396, 375, 511, 371, 489, 432, 1000, 1000, 400, 708,
        1000, 672, 380, 440, 391, 1000, 433, 375, 950, 483, 1000, 1000, 461,
        625, 974, 1000, 1000, 430, 575, 433, 545, 415, 380, 470, 580, 642, 460,
        896, 403, 754, 564, 392, 430, 1000, 1000, 370, 741, 603, 410, 643, 515,
        371, 622, 644, 505, 1000, 375, 437, 380, 400, 706, 487, 525, 389, 393,
        378, 389, 978, 386, 1000, 1000, 882, 1000, 547, 400, 1000, 370, 829,
        494, 749, 610, 906, 1000, 403, 1000, 744, 423, 1000, 432, 617, 833,
        502, 380, 996, 589, 429, 525, 416, 430, 1000, 403, 1000, 397, 381, 749,
        432, 539, 1000, 1000, 484, 558, 422, 399, 516, 480, 1000, 684, 594,
        677, 424, 432, 443, 864, 509, 371, 547, 501, 428, 580, 1000, 1000, 689,
        391, 618, 524, 482, 682, 624, 1000, 436, 742, 499, 1000, 458, 397,
        1000, 1000, 406, 375, 407, 661, 592, 662, 436, 378, 465, 508, 429, 473,
        380, 882, 623, 1000, 409, 508, 584, 511, 1000, 375, 1000, 373, 501,
        381, 1000, 493, 440, 494, 413, 757, 624, 491, 734, 413, 863, 1000, 397,
        389, 386, 371, 876, 1000, 819, 460, 422, 407, 1000, 497, 1000, 432,
        400, 422, 399, 510, 466, 1000, 436, 573, 381, 376, 1000, 578, 419, 719,
        482, 656, 390, 388, 511, 843, 426, 723, 538, 372, 400, 884, 1000, 415,
        450, 681, 656, 1000, 497, 425, 1000, 1000, 444, 820, 450, 816, 431,
        399, 370, 394, 387, 1000, 625, 385, 524, 422, 385, 387, 403, 1000,
        1000, 593, 1000, 1000, 530, 458, 1000, 472, 436, 1000, 441, 456, 1000,
        449, 394, 786, 391, 1000, 1000, 706, 383, 375, 517, 1000, 592, 422,
        501, 1000, 429, 449, 1000, 386, 591, 1000, 590, 591, 371, 876, 415,
        389, 375, 1000, 1000, 795, 1000, 472, 401, 451, 392, 469, 493, 437,
        415, 1000, 430, 554, 952, 1000, 442, 620, 634, 440, 1000, 800, 1000,
        378, 441, 617, 373, 1000, 1000, 1000, 442, 1000, 530, 436, 499, 503,
        597, 523, 444, 1000, 544, 691, 737, 390, 452, 385, 397, 809, 400, 380,
        499, 846, 501, 1000, 809, 371, 640, 1000, 377, 415, 383, 524, 371, 400,
        479, 389, 508, 985, 410, 486, 380, 423, 1000, 499, 1000, 409, 382, 436,
        1000, 382, 660, 592, 420, 1000, 380, 389, 1000, 400, 759, 436, 808,
        1000, 1000, 410, 415, 400, 1000, 1000, 703, 482, 646, 400, 938, 475,
        651, 1000, 482, 596, 624, 1000, 416, 1000, 424, 373, 371, 483, 809,
        444, 415, 390, 1000, 1000, 495, 857, 436, 445, 383, 432, 553, 621, 375,
        460, 473, 748, 566, 632, 484, 504, 520, 1000, 1000, 380, 371, 1000,
        1000, 1000, 914, 813, 1000, 467, 409, 797, 400, 515, 581, 1000, 524,
        400, 821, 1000, 489, 490, 432, 524, 444, 559, 1000, 1000, 1000, 376,
        593, 470, 468, 375, 395, 451, 422, 375, 389, 521, 751, 745, 443, 849,
        1000, 489, 394, 445, 713, 530, 407, 1000, 503, 519, 402, 382, 1000,
        385, 389, 901, 444, 731, 877, 1000, 1000, 525, 636, 1000, 1000, 439,
        1000, 591, 754, 422, 489, 846, 378, 1000, 533, 533, 1000, 370, 631,
        1000, 382, 378, 422, 1000, 669, 1000, 407, 403, 1000, 524, 372, 504,
        994, 1000, 1000, 425, 373, 371, 1000, 432, 393, 1000, 1000, 660, 592,
        1000, 769, 493, 400, 1000, 406, 393, 372, 385, 593, 393, 762, 482, 425,
        416, 378, 371, 440, 1000, 684, 438, 380, 380, 385, 471, 581, 1000, 552,
        424, 386, 459, 1000, 1000, 438, 566, 597, 1000, 482, 1000, 372, 897,
        1000, 400, 407, 482, 534, 940, 686, 411, 424, 921, 1000, 1000, 465,
        464, 400, 383, 714, 434, 391, 513, 884, 457, 432, 517, 1000, 773, 791,
        525, 393, 396, 461, 1000, 429, 371, 1000, 458, 371, 713, 1000, 1000,
        763, 436, 668, 609, 437, 443, 543, 616, 670, 694};
    //}}}

    char *file_name = "../data/many/2.1.bed.gz";
    struct input_file *i = input_file_init(file_name);

    int chrm_len = 10;
    char *chrm = (char *)malloc(chrm_len*sizeof(char));
    uint32_t start, end;
    long offset;
    kstring_t line = {0, 0, NULL};

    offset_data_size = sizeof(struct offset_data_append_data_test_struct);
    offset_data_append_data = offset_data_append_data_test_func;

    struct offset_index *offset_idx = 
            offset_index_init(100,
                              "tmp.test_offset_index_add");
    TEST_ASSERT_EQUAL(on_disk, offset_idx->type);
    uint32_t intrv_id;

    while (i->input_file_get_next_interval(i,
                                           &chrm,
                                           &chrm_len,
                                           &start,
                                           &end,
                                           &offset,
                                           &line) >= 0) {
        intrv_id = offset_index_add(offset_idx,
                                    offset,
                                    &line,
                                    1);

    }

    TEST_ASSERT_EQUAL(1000, offset_idx->index->num);
    
    uint32_t j;
    for (j = 0; j < 1000; ++j) {
        TEST_ASSERT_EQUAL(A_offsets[j], 
                          OFFSET_INDEX_PAIR(offset_idx, j)->offset);
        struct offset_data_append_data_test_struct *tmp;
        tmp = (struct offset_data_append_data_test_struct *)
                OFFSET_INDEX_DATA(offset_idx, j);
        TEST_ASSERT_EQUAL(A_data[j], tmp->data);
    }

    if (line.s != NULL)
        free(line.s);
    input_file_destroy(&i);
    offset_index_destroy(&offset_idx);
    free(chrm);
}
//}}}

//{{{ void test_offset_index_add_larger_data(void)
struct offset_data_append_data_test_struct_larger
{
    uint32_t uint;
    float flt;
    char concat[20];
};

void offset_data_append_data_test_func_larger(uint8_t *dest, kstring_t *line)
{
    int n;
    int *fields = ksplit(line, '\t', &n);

    struct offset_data_append_data_test_struct_larger a;
    a.uint = atoi(line->s + fields[4]);
    a.flt = atof(line->s + fields[6]);
    memset(&a.concat, 0, 20);
    int ret = sprintf(a.concat, "%u %.6f", a.uint, a.flt);

    /*
    fprintf(stderr,
            "offset_data_append_data_test_func_larger: dest:%p line:%s uint:%u flt:%f\n",
            dest,
            line->s,
            a.uint,
            a.flt);
    */

    memcpy(dest, &a, sizeof(struct offset_data_append_data_test_struct_larger));

    free(fields);
}

void test_offset_index_add_data_larger(void)
{ 
    //{{{ uint32_t A_offsets[1000] = 
    uint32_t A_offsets[1000] = {0, 61, 118, 173, 230, 292, 350, 412, 476, 534,
        599, 661, 726, 784, 841, 899, 964, 1026, 1085, 1145, 1204, 1267, 1330,
        1388, 1447, 1508, 1566, 1627, 1686, 1747, 1810, 1873, 1935, 1992, 2050,
        2108, 2167, 2226, 2285, 2344, 2401, 2460, 2519, 2578, 2636, 2702, 2766,
        2826, 2886, 2947, 3009, 3069, 3128, 3188, 3248, 3312, 3375, 3441, 3499,
        3559, 3622, 3683, 3746, 3804, 3863, 3922, 3983, 4043, 4104, 4164, 4225,
        4285, 4352, 4413, 4480, 4544, 4607, 4668, 4729, 4792, 4853, 4917, 4978,
        5037, 5101, 5161, 5218, 5285, 5346, 5409, 5465, 5526, 5583, 5645, 5706,
        5767, 5827, 5887, 5950, 6010, 6069, 6133, 6193, 6254, 6316, 6375, 6435,
        6494, 6557, 6616, 6676, 6736, 6796, 6855, 6915, 6975, 7033, 7092, 7158,
        7218, 7277, 7337, 7397, 7455, 7518, 7577, 7637, 7701, 7761, 7822, 7885,
        7951, 8016, 8078, 8140, 8202, 8264, 8326, 8388, 8453, 8513, 8575, 8636,
        8698, 8752, 8810, 8868, 8926, 8985, 9043, 9103, 9162, 9222, 9282, 9341,
        9401, 9461, 9524, 9583, 9641, 9700, 9762, 9822, 9882, 9945, 10008,
        10065, 10128, 10188, 10248, 10308, 10370, 10427, 10487, 10547, 10606,
        10665, 10726, 10788, 10853, 10914, 10976, 11039, 11104, 11168, 11229,
        11291, 11355, 11413, 11470, 11525, 11584, 11641, 11698, 11755, 11815,
        11877, 11936, 11999, 12058, 12120, 12184, 12244, 12304, 12364, 12427,
        12491, 12549, 12610, 12674, 12738, 12803, 12869, 12929, 12990, 13049,
        13111, 13171, 13233, 13296, 13356, 13416, 13480, 13539, 13599, 13663,
        13725, 13787, 13851, 13913, 13978, 14044, 14105, 14166, 14226, 14288,
        14351, 14411, 14471, 14530, 14589, 14651, 14715, 14773, 14832, 14893,
        14957, 15016, 15075, 15135, 15194, 15253, 15313, 15373, 15432, 15491,
        15550, 15610, 15670, 15731, 15790, 15848, 15910, 15970, 16033, 16092,
        16156, 16216, 16276, 16335, 16392, 16452, 16511, 16569, 16628, 16686,
        16746, 16804, 16870, 16932, 16993, 17055, 17116, 17176, 17235, 17297,
        17357, 17415, 17474, 17537, 17596, 17656, 17717, 17779, 17839, 17899,
        17958, 18018, 18079, 18138, 18200, 18259, 18317, 18376, 18439, 18503,
        18566, 18625, 18687, 18748, 18808, 18870, 18931, 18991, 19054, 19115,
        19175, 19234, 19296, 19358, 19417, 19475, 19536, 19596, 19658, 19716,
        19776, 19837, 19899, 19958, 20016, 20073, 20137, 20203, 20262, 20321,
        20382, 20441, 20504, 20564, 20629, 20688, 20747, 20806, 20865, 20923,
        20982, 21041, 21103, 21164, 21222, 21285, 21341, 21398, 21457, 21516,
        21575, 21634, 21694, 21757, 21822, 21881, 21941, 22000, 22059, 22123,
        22181, 22239, 22297, 22355, 22411, 22470, 22531, 22595, 22654, 22715,
        22778, 22839, 22898, 22956, 23016, 23080, 23140, 23199, 23259, 23319,
        23382, 23445, 23504, 23564, 23626, 23693, 23757, 23816, 23876, 23936,
        23996, 24055, 24113, 24172, 24232, 24293, 24353, 24415, 24474, 24536,
        24594, 24653, 24712, 24776, 24840, 24896, 24956, 25012, 25069, 25128,
        25184, 25244, 25303, 25364, 25424, 25487, 25546, 25606, 25664, 25722,
        25784, 25843, 25902, 25962, 26021, 26079, 26138, 26200, 26259, 26321,
        26382, 26443, 26505, 26563, 26620, 26682, 26738, 26798, 26856, 26915,
        26975, 27036, 27098, 27158, 27221, 27283, 27343, 27406, 27466, 27525,
        27587, 27646, 27705, 27767, 27828, 27887, 27947, 28006, 28065, 28131,
        28191, 28254, 28314, 28372, 28431, 28491, 28551, 28615, 28681, 28741,
        28800, 28859, 28919, 28978, 29038, 29104, 29165, 29225, 29287, 29344,
        29401, 29458, 29519, 29578, 29636, 29695, 29754, 29812, 29871, 29934,
        29996, 30057, 30116, 30174, 30233, 30291, 30352, 30411, 30473, 30531,
        30592, 30652, 30716, 30775, 30834, 30896, 30959, 31016, 31074, 31133,
        31194, 31254, 31317, 31376, 31436, 31497, 31558, 31618, 31678, 31739,
        31802, 31865, 31928, 31988, 32048, 32106, 32167, 32231, 32290, 32355,
        32414, 32474, 32534, 32599, 32660, 32721, 32781, 32842, 32905, 32966,
        33027, 33090, 33151, 33213, 33278, 33338, 33399, 33460, 33520, 33578,
        33639, 33699, 33759, 33819, 33878, 33941, 34001, 34065, 34125, 34185,
        34245, 34304, 34362, 34421, 34487, 34546, 34605, 34664, 34724, 34787,
        34846, 34905, 34967, 35027, 35089, 35148, 35207, 35267, 35329, 35389,
        35451, 35511, 35570, 35630, 35691, 35755, 35814, 35873, 35935, 35998,
        36064, 36124, 36183, 36247, 36310, 36369, 36430, 36489, 36551, 36611,
        36670, 36730, 36790, 36850, 36914, 36974, 37033, 37093, 37152, 37210,
        37269, 37327, 37390, 37455, 37512, 37571, 37631, 37687, 37743, 37806,
        37864, 37922, 37985, 38043, 38102, 38164, 38223, 38280, 38341, 38399,
        38461, 38522, 38583, 38642, 38700, 38760, 38822, 38882, 38940, 38999,
        39064, 39124, 39185, 39248, 39309, 39369, 39434, 39495, 39556, 39616,
        39680, 39741, 39802, 39862, 39925, 39990, 40052, 40116, 40177, 40237,
        40298, 40359, 40418, 40479, 40540, 40599, 40665, 40726, 40787, 40850,
        40914, 40970, 41027, 41085, 41141, 41202, 41260, 41322, 41379, 41438,
        41498, 41552, 41614, 41677, 41738, 41797, 41860, 41918, 41975, 42032,
        42091, 42150, 42209, 42267, 42329, 42387, 42448, 42509, 42569, 42630,
        42690, 42751, 42814, 42874, 42934, 42995, 43059, 43119, 43182, 43245,
        43304, 43366, 43430, 43486, 43544, 43602, 43661, 43718, 43777, 43836,
        43895, 43953, 44014, 44073, 44132, 44190, 44249, 44312, 44369, 44431,
        44489, 44548, 44609, 44674, 44735, 44797, 44858, 44919, 44984, 45045,
        45103, 45168, 45228, 45290, 45349, 45412, 45475, 45538, 45598, 45659,
        45719, 45784, 45847, 45910, 45971, 46032, 46093, 46157, 46218, 46280,
        46344, 46405, 46465, 46526, 46590, 46650, 46714, 46774, 46833, 46893,
        46953, 47017, 47077, 47131, 47186, 47245, 47305, 47361, 47420, 47476,
        47533, 47588, 47647, 47706, 47765, 47824, 47883, 47942, 48003, 48061,
        48121, 48180, 48239, 48298, 48360, 48422, 48478, 48536, 48598, 48663,
        48724, 48785, 48844, 48908, 48967, 49026, 49086, 49145, 49204, 49263,
        49325, 49383, 49443, 49506, 49570, 49630, 49691, 49751, 49812, 49873,
        49933, 49996, 50063, 50127, 50188, 50249, 50309, 50370, 50430, 50490,
        50551, 50605, 50658, 50712, 50769, 50827, 50887, 50943, 51003, 51066,
        51125, 51183, 51242, 51303, 51361, 51419, 51481, 51539, 51598, 51657,
        51715, 51778, 51836, 51894, 51955, 52013, 52074, 52137, 52201, 52265,
        52325, 52387, 52451, 52515, 52574, 52641, 52701, 52764, 52824, 52884,
        52947, 53006, 53070, 53131, 53192, 53254, 53314, 53376, 53439, 53498,
        53556, 53617, 53682, 53745, 53806, 53866, 53925, 53987, 54048, 54108,
        54169, 54232, 54297, 54356, 54413, 54468, 54525, 54588, 54646, 54704,
        54766, 54829, 54890, 54949, 55012, 55072, 55129, 55187, 55250, 55307,
        55365, 55423, 55482, 55540, 55598, 55659, 55716, 55775, 55833, 55890,
        55948, 56006, 56071, 56133, 56194, 56254, 56314, 56374, 56435, 56496,
        56560, 56621, 56681, 56742, 56800, 56863, 56926, 56985, 57043, 57101,
        57163, 57223, 57285, 57342, 57403, 57466, 57523, 57581, 57641, 57698,
        57759, 57820, 57879, 57937, 57998, 58063, 58126, 58183, 58244, 58305,
        58365, 58428, 58489, 58549, 58610, 58672, 58733, 58793, 58853, 58918,
        58982, 59044, 59104, 59164, 59225, 59286, 59347, 59404, 59460, 59522,
        59581, 59637, 59698, 59760, 59823, 59883, 59944, 60007, 60068, 60127,
        60187, 60249, 60310, 60372};
    //}}}

    //{{{uint32_t A_data[1000] = 
    uint32_t A_data[1000] = {1000, 453, 421, 506, 1000, 426, 1000, 1000, 531,
        1000, 1000, 1000, 490, 397, 497, 1000, 1000, 606, 680, 604, 1000, 1000,
        534, 482, 692, 448, 893, 494, 670, 1000, 1000, 1000, 487, 565, 472,
        427, 613, 552, 577, 371, 638, 422, 478, 397, 1000, 1000, 459, 429, 603,
        630, 429, 426, 443, 380, 752, 768, 1000, 440, 422, 933, 537, 876, 386,
        415, 379, 481, 415, 556, 409, 579, 473, 1000, 442, 1000, 1000, 905,
        496, 392, 856, 489, 1000, 427, 415, 1000, 382, 408, 1000, 523, 973,
        408, 1000, 453, 1000, 1000, 1000, 545, 517, 1000, 402, 370, 1000, 495,
        945, 1000, 482, 430, 414, 1000, 465, 581, 499, 375, 468, 501, 538, 378,
        443, 1000, 490, 524, 477, 517, 437, 1000, 397, 370, 1000, 416, 473,
        993, 1000, 801, 592, 535, 433, 531, 386, 393, 1000, 385, 385, 378, 403,
        388, 918, 1000, 956, 795, 408, 488, 378, 464, 418, 595, 502, 459, 919,
        596, 385, 448, 931, 617, 497, 772, 754, 385, 1000, 646, 441, 515, 712,
        379, 410, 597, 371, 420, 872, 719, 1000, 410, 410, 973, 1000, 732, 403,
        470, 719, 1000, 400, 436, 552, 386, 389, 393, 373, 788, 371, 1000, 397,
        896, 1000, 380, 526, 372, 937, 1000, 373, 964, 1000, 1000, 1000, 1000,
        419, 689, 373, 888, 406, 1000, 1000, 423, 592, 1000, 423, 523, 995,
        383, 473, 795, 472, 654, 1000, 391, 402, 407, 461, 1000, 395, 424, 407,
        378, 872, 1000, 378, 479, 503, 1000, 400, 380, 380, 389, 370, 509, 371,
        393, 378, 444, 436, 478, 424, 383, 393, 986, 472, 1000, 483, 1000, 380,
        373, 516, 371, 481, 380, 407, 430, 378, 580, 373, 1000, 502, 415, 419,
        380, 483, 382, 656, 517, 423, 391, 692, 395, 538, 699, 706, 422, 405,
        372, 569, 841, 508, 1000, 436, 424, 439, 1000, 1000, 1000, 424, 785,
        646, 580, 724, 640, 427, 1000, 1000, 448, 466, 554, 422, 1000, 772,
        717, 744, 1000, 578, 499, 914, 694, 380, 402, 393, 1000, 1000, 461,
        380, 646, 490, 1000, 495, 1000, 525, 436, 414, 393, 371, 509, 530, 668,
        643, 375, 756, 393, 491, 490, 493, 408, 524, 567, 1000, 1000, 556, 511,
        452, 465, 1000, 396, 375, 511, 371, 489, 432, 1000, 1000, 400, 708,
        1000, 672, 380, 440, 391, 1000, 433, 375, 950, 483, 1000, 1000, 461,
        625, 974, 1000, 1000, 430, 575, 433, 545, 415, 380, 470, 580, 642, 460,
        896, 403, 754, 564, 392, 430, 1000, 1000, 370, 741, 603, 410, 643, 515,
        371, 622, 644, 505, 1000, 375, 437, 380, 400, 706, 487, 525, 389, 393,
        378, 389, 978, 386, 1000, 1000, 882, 1000, 547, 400, 1000, 370, 829,
        494, 749, 610, 906, 1000, 403, 1000, 744, 423, 1000, 432, 617, 833,
        502, 380, 996, 589, 429, 525, 416, 430, 1000, 403, 1000, 397, 381, 749,
        432, 539, 1000, 1000, 484, 558, 422, 399, 516, 480, 1000, 684, 594,
        677, 424, 432, 443, 864, 509, 371, 547, 501, 428, 580, 1000, 1000, 689,
        391, 618, 524, 482, 682, 624, 1000, 436, 742, 499, 1000, 458, 397,
        1000, 1000, 406, 375, 407, 661, 592, 662, 436, 378, 465, 508, 429, 473,
        380, 882, 623, 1000, 409, 508, 584, 511, 1000, 375, 1000, 373, 501,
        381, 1000, 493, 440, 494, 413, 757, 624, 491, 734, 413, 863, 1000, 397,
        389, 386, 371, 876, 1000, 819, 460, 422, 407, 1000, 497, 1000, 432,
        400, 422, 399, 510, 466, 1000, 436, 573, 381, 376, 1000, 578, 419, 719,
        482, 656, 390, 388, 511, 843, 426, 723, 538, 372, 400, 884, 1000, 415,
        450, 681, 656, 1000, 497, 425, 1000, 1000, 444, 820, 450, 816, 431,
        399, 370, 394, 387, 1000, 625, 385, 524, 422, 385, 387, 403, 1000,
        1000, 593, 1000, 1000, 530, 458, 1000, 472, 436, 1000, 441, 456, 1000,
        449, 394, 786, 391, 1000, 1000, 706, 383, 375, 517, 1000, 592, 422,
        501, 1000, 429, 449, 1000, 386, 591, 1000, 590, 591, 371, 876, 415,
        389, 375, 1000, 1000, 795, 1000, 472, 401, 451, 392, 469, 493, 437,
        415, 1000, 430, 554, 952, 1000, 442, 620, 634, 440, 1000, 800, 1000,
        378, 441, 617, 373, 1000, 1000, 1000, 442, 1000, 530, 436, 499, 503,
        597, 523, 444, 1000, 544, 691, 737, 390, 452, 385, 397, 809, 400, 380,
        499, 846, 501, 1000, 809, 371, 640, 1000, 377, 415, 383, 524, 371, 400,
        479, 389, 508, 985, 410, 486, 380, 423, 1000, 499, 1000, 409, 382, 436,
        1000, 382, 660, 592, 420, 1000, 380, 389, 1000, 400, 759, 436, 808,
        1000, 1000, 410, 415, 400, 1000, 1000, 703, 482, 646, 400, 938, 475,
        651, 1000, 482, 596, 624, 1000, 416, 1000, 424, 373, 371, 483, 809,
        444, 415, 390, 1000, 1000, 495, 857, 436, 445, 383, 432, 553, 621, 375,
        460, 473, 748, 566, 632, 484, 504, 520, 1000, 1000, 380, 371, 1000,
        1000, 1000, 914, 813, 1000, 467, 409, 797, 400, 515, 581, 1000, 524,
        400, 821, 1000, 489, 490, 432, 524, 444, 559, 1000, 1000, 1000, 376,
        593, 470, 468, 375, 395, 451, 422, 375, 389, 521, 751, 745, 443, 849,
        1000, 489, 394, 445, 713, 530, 407, 1000, 503, 519, 402, 382, 1000,
        385, 389, 901, 444, 731, 877, 1000, 1000, 525, 636, 1000, 1000, 439,
        1000, 591, 754, 422, 489, 846, 378, 1000, 533, 533, 1000, 370, 631,
        1000, 382, 378, 422, 1000, 669, 1000, 407, 403, 1000, 524, 372, 504,
        994, 1000, 1000, 425, 373, 371, 1000, 432, 393, 1000, 1000, 660, 592,
        1000, 769, 493, 400, 1000, 406, 393, 372, 385, 593, 393, 762, 482, 425,
        416, 378, 371, 440, 1000, 684, 438, 380, 380, 385, 471, 581, 1000, 552,
        424, 386, 459, 1000, 1000, 438, 566, 597, 1000, 482, 1000, 372, 897,
        1000, 400, 407, 482, 534, 940, 686, 411, 424, 921, 1000, 1000, 465,
        464, 400, 383, 714, 434, 391, 513, 884, 457, 432, 517, 1000, 773, 791,
        525, 393, 396, 461, 1000, 429, 371, 1000, 458, 371, 713, 1000, 1000,
        763, 436, 668, 609, 437, 443, 543, 616, 670, 694};
    //}}}

    //{{{float A_flt[1000] = {
    float A_flt[1000] = { 12.12021, 3.88225, 3.4088, 14.7654, 3.48997, 1.87484,
        6.77027, 11.9687, 3.91381, 14.51326, 15.4361, 70.82748, 10.98394,
        3.4088, 7.00699, 14.99353, 6.74875, 3.70339, 5.9086, 9.46891, 11.11019,
        12.83984, 2.98867, 10.60518, 3.52535, 9.09015, 6.88074, 5.51758,
        6.57388, 9.72435, 19.31658, 8.55989, 4.3557, 3.29518, 3.34568,
        14.73803, 3.03005, 3.24808, 3.78756, 5.30259, 7.87982, 5.11321,
        2.65129, 703.58101, 16.76629, 9.75298, 6.42889, 5.30259, 4.22043,
        10.03705, 4.74661, 3.18155, 4.29257, 2.21843, 18.93783, 2.25607,
        221.42388, 8.7114, 5.11321, 5.26471, 7.95388, 8.08975, 7.6656, 3.31412,
        3.03005, 2.86171, 7.21588, 6.18635, 3.21943, 3.32893, 9.87197,
        15.46589, 3.03005, 12.27171, 17.15226, 7.70302, 2.27253, 2.46191,
        4.22459, 3.93906, 5.11321, 3.50349, 5.51496, 18.43282, 2.33566,
        7.19637, 19.94784, 4.31782, 3.47468, 8.91237, 55.35055, 8.03434,
        24.23541, 7.40464, 5.32535, 4.15464, 35.09704, 7.00258, 4.06529,
        2.34536, 23.12527, 3.14278, 9.09766, 7.56379, 3.40077, 7.28391,
        5.62886, 9.42185, 5.47251, 4.92526, 3.02764, 2.27835, 3.6744, 3.57667,
        3.47113, 7.03608, 5.59169, 17.01169, 3.61855, 8.00551, 3.48453,
        5.54992, 4.10438, 6.30188, 45.08121, 2.34536, 34.71985, 9.38144,
        12.66495, 11.96134, 31.76898, 11.72681, 7.97423, 6.87972, 3.56495,
        5.62886, 4.69072, 4.92526, 6.09794, 7.27949, 2.81443, 7.03608, 3.09587,
        4.29351, 7.28596, 9.12913, 14.21216, 7.02574, 4.87899, 30.27434,
        5.85479, 2.81897, 2.62071, 3.51287, 5.46447, 2.43949, 11.94931,
        5.07415, 6.2451, 2.68886, 5.07415, 4.34927, 15.91178, 13.46601,
        13.07569, 6.2451, 12.33409, 4.57231, 2.73223, 4.87899, 3.51287,
        3.12255, 3.77308, 3.95198, 5.46447, 2.17928, 9.1725, 8.49777, 9.98567,
        3.77308, 3.77308, 4.7739, 5.04813, 9.10745, 3.22013, 7.32016, 8.56192,
        278.95909, 4.47425, 4.47425, 14.64303, 4.0675, 74.15807, 4.27088,
        3.66075, 9.23069, 5.69451, 6.72335, 3.66075, 3.84153, 26.57438,
        25.86841, 2.63032, 2.64388, 12.60927, 25.57446, 2.03375, 7.79605,
        16.21919, 15.89002, 19.9522, 28.35634, 3.45738, 4.37627, 3.66075,
        7.18593, 711.99196, 8.13501, 7.10458, 4.20309, 5.89788, 11.72182,
        2.59303, 5.28467, 4.76479, 2.32429, 2.93764, 5.38944, 4.27088,
        10.77889, 10.98227, 3.52517, 2.55671, 3.254, 20.84931, 20.3708,
        3.18293, 3.18293, 4.8805, 8.27563, 7.35612, 24.57228, 8.27563,
        17.58992, 10.50369, 10.82198, 4.6683, 4.03172, 2.63729, 3.81952,
        7.63905, 5.38724, 1.66492, 4.45611, 8.27563, 5.94148, 12.73175,
        9.54881, 120.4028, 2.84145, 6.90067, 4.38903, 5.14167, 8.64033,
        6.69771, 6.37121, 2.36787, 1.76866, 7.50955, 5.6829, 6.73498, 3.85625,
        2.60949, 6.33298, 6.08882, 7.03598, 3.65329, 16.10157, 4.22158,
        20.45145, 3.45033, 3.85625, 6.81006, 2.65302, 7.06046, 6.27596, 4.4217,
        3.70852, 11.79783, 2.50631, 2.46046, 12.4093, 8.80896, 5.72578,
        2.46046, 2.78139, 5.88372, 6.4186, 7.70232, 6.2211, 4.70697, 8.98604,
        2.11436, 6.97488, 13.93754, 9.41395, 28.7183, 5.99069, 4.27906,
        7.41705, 6.76093, 3.97953, 2.37293, 6.10739, 6.4186, 8.49451, 1.9652,
        3.79767, 2.43906, 8.59356, 13.44763, 14.87347, 9.17197, 14.74953,
        6.69306, 2.89842, 8.59356, 7.23842, 4.70993, 4.29678, 8.4283, 12.27062,
        14.30332, 7.50125, 2.25856, 4.36288, 3.8246, 6.66552, 4.21415,
        132.01495, 16.36082, 5.12308, 5.94939, 5.20571, 6.94095, 6.02564,
        4.6273, 9.91565, 7.68463, 3.09864, 11.56826, 8.4283, 8.4283, 14.37769,
        3.59442, 7.65796, 4.17873, 5.65192, 7.84238, 10.78327, 3.71836,
        6.77569, 7.18884, 5.78413, 10.23115, 2.77158, 2.45482, 3.89341,
        1.40558, 6.64682, 10.11018, 8.14505, 24.74626, 8.89158, 3.40508,
        7.80002, 8.41589, 2.87056, 9.10662, 3.06853, 14.19728, 23.05476,
        2.77158, 5.50356, 1.93874, 8.97464, 4.89715, 2.34735, 4.20686, 8.78987,
        32.86303, 15.93659, 3.2467, 3.01523, 3.76143, 2.69239, 5.14722,
        2.53401, 14.9326, 4.55331, 5.62235, 3.36549, 5.22641, 3.2665, 6.73098,
        6.599, 2.57361, 3.03554, 12.67008, 13.46196, 2.33794, 6.00072, 4.25505,
        2.56394, 3.19129, 4.546, 2.12752, 5.81888, 12.42236, 2.58404, 7.85549,
        3.6368, 4.50054, 2.63668, 5.4552, 7.85549, 5.4552, 12.73173, 17.79964,
        5.18244, 7.09176, 3.16401, 17.89681, 7.63728, 23.66953, 7.53271,
        13.70596, 15.50422, 6.09442, 6.58198, 13.31022, 2.92532, 4.91617,
        8.07562, 6.985, 7.06953, 6.26855, 10.6043, 3.01674, 5.53584, 9.01975,
        2.66413, 7.77039, 3.14472, 7.7539, 8.19699, 3.94918, 4.17865, 4.87554,
        20.61221, 5.11931, 3.83948, 7.31331, 7.93728, 17.58677, 2.77905,
        12.70687, 2.40294, 3.83948, 5.22379, 3.14472, 3.96137, 12.43263,
        47.90219, 2.74249, 8.9588, 4.93648, 1.98068, 5.60687, 4.11373,
        27.75734, 5.18026, 3.57539, 9.53361, 3.88196, 2.63503, 2.72913,
        12.16264, 5.29359, 3.29378, 5.62242, 4.51719, 2.95768, 3.59322,
        27.57372, 6.74442, 6.03861, 2.91735, 7.1355, 8.94028, 3.41142, 4.75769,
        2.91735, 9.81469, 4.86226, 5.17595, 14.11624, 34.34951, 2.62718,
        941.31799, 4.42308, 10.56239, 6.58757, 2.43113, 1.42451, 4.10654,
        10.82245, 3.92117, 6.3523, 7.05812, 5.48964, 4.73982, 6.11703, 6.65148,
        18.89433, 356.30091, 293.75971, 10.60102, 4.23487, 4.6113, 7.8496,
        6.43073, 10.19506, 2.94088, 23.91918, 3.24673, 3.58787, 4.00325,
        10.19506, 2.99435, 3.67022, 5.05831, 2.70561, 5.28051, 4.33943,
        2.86245, 5.12367, 2.70561, 31.8797, 14.78844, 92.30747, 610.58464,
        4.70541, 3.29378, 8.28664, 6.62077, 4.44232, 3.75888, 6.87706, 5.86581,
        6.50748, 3.75888, 16.42786, 2.32367, 2.08447, 2.93876, 2.90459,
        3.89557, 5.63833, 14.66536, 4.9549, 4.51066, 3.58803, 2.00758, 6.05807,
        2.26387, 2.4399, 3.31953, 2.78779, 5.70311, 2.5287, 2.73373, 2.38517,
        9.71738, 3.09189, 5.55278, 3.97529, 2.35572, 2.25266, 8.6573, 17.99924,
        6.52081, 4.85869, 7.15639, 10.11753, 46.59926, 22.22549, 3.86486,
        62.05873, 6.65638, 2.88552, 8.07947, 2.93799, 3.23178, 1.65818,
        3.55007, 2.09856, 4.22336, 3.30523, 17.87277, 5.21493, 5.87598,
        8.53824, 4.95785, 5.87598, 2.57074, 3.0298, 10.7948, 12.87665, 3.38472,
        6.62337, 6.41995, 3.47825, 2.89037, 10.73001, 5.19463, 2.69441,
        16.18051, 2.7434, 2.38164, 3.65484, 3.44885, 4.50702, 3.03308, 3.03048,
        6.58418, 8.08771, 3.28229, 2.23951, 3.91915, 11.88933, 5.29086,
        10.25454, 3.40792, 4.70298, 14.73023, 5.40111, 3.44885, 5.91792,
        13.13354, 2.76646, 14.78081, 12.97096, 2.64027, 5.48681, 10.09529,
        17.67994, 13.15142, 3.91915, 4.74909, 12.23336, 7.05448, 5.74809,
        4.96426, 2.82179, 2.65631, 2.35149, 2.98835, 3.18431, 2.46906, 5.0949,
        44.87433, 4.18043, 8.62214, 6.27064, 5.13025, 2.80661, 3.43829,
        5.56028, 10.8051, 22.24113, 12.43104, 6.72841, 7.14893, 3.60658,
        11.96839, 4.28936, 7.14893, 11.98298, 7.6851, 2.26383, 9.27773,
        4.95659, 2.62127, 7.90684, 6.35461, 5.41946, 4.21893, 6.67234, 9.87853,
        4.60709, 5.16776, 5.48085, 2.10496, 6.91063, 2.3234, 3.05021, 6.01702,
        5.07265, 4.52766, 8.34042, 12.54419, 4.57531, 6.08227, 6.01702, 4.7149,
        5.10638, 3.61955, 3.25597, 2.95997, 3.10797, 3.10797, 6.21595, 2.08336,
        4.77296, 1.62798, 4.52876, 7.61137, 3.19677, 4.88396, 93.19067,
        4.23694, 4.27716, 7.57789, 5.18921, 3.99597, 2.34683, 4.58796,
        12.93933, 2.51598, 9.19883, 7.54794, 3.03397, 11.91391, 15.83552,
        66.766, 4.46463, 4.88396, 6.51195, 4.58796, 8.73091, 6.13001, 8.6826,
        2.35318, 166.66526, 7.99194, 10.65592, 7.2654, 6.87075, 10.34996,
        4.3413, 2.49748, 14.62498, 3.05864, 8.58393, 7.07782, 3.77397, 4.27346,
        6.88194, 6.90661, 8.87993, 9.19961, 9.32393, 3.99597, 3.10797, 3.32997,
        15.53988, 6.21595, 22.91597, 1.75206, 6.51226, 4.33224, 2.9566,
        4.07902, 4.87641, 2.58703, 3.77788, 2.62809, 2.37258, 2.60984, 2.54596,
        3.96007, 2.66459, 2.87447, 5.0098, 4.12986, 2.73759, 2.54596, 11.49791,
        6.67973, 3.92785, 2.20943, 3.44937, 6.33906, 10.21515, 7.68677,
        5.46142, 5.831, 6.92731, 2.00565, 1.74629, 2.80603, 2.21745, 5.25618,
        4.37766, 5.34069, 7.9774, 5.95029, 4.92767, 4.91707, 2.0921, 1.92053,
        3.94214, 3.16192, 1.82823, 4.92767, 7.30306, 12.37394, 5.09193,
        1.66445, 2.57012, 9.52684, 3.86001, 2.54596, 3.28511, 4.95543, 5.96741,
        3.45937, 3.00965, 6.91874, 6.44925, 15.56717, 4.4107, 20.14233,
        50.63039, 3.85473, 3.97827, 3.94368, 5.24671, 4.2995, 5.44851,
        10.41518, 2.76749, 6.61812, 2.35866, 2.5204, 10.63757, 4.67015,
        625.8006, 7.78358, 3.33582, 3.66116, 23.55738, 7.00523, 20.11554,
        5.83769, 3.63234, 9.50246, 7.13495, 2.80209, 5.30362, 3.8682, 4.26244,
        2.54735, 3.85473, 8.98668, 4.4107, 5.88093, 3.80531, 3.80531, 4.874,
        1.72968, 4.61249, 6.14903, 2.5204, 4.4107, 6.72949, 15.48069, 5.25392,
        9.643, 2.33507, 3.63234, 5.86931, 3.95665, 4.15124, 3.37288, 4.24559,
        13.07643, 8.1283, 3.68784, 3.7932, 5.90054, 32.52693, 3.7932, 7.16494,
        7.52157, 10.26848, 4.53077, 6.11127, 16.12113, 5.86378, 3.49215,
        4.63614, 11.41474, 2.80978, 2.03709, 2.44451, 1.79123, 3.33661,
        7.16494, 9.31376, 3.8803, 3.68784, 3.11885, 2.8449, 5.90054, 9.69375,
        15.1404, 5.11781, 3.89857, 92.81556, 4.00394, 3.51222, 2.46859,
        4.27488, 5.77878, 5.00768, 8.19586, 4.21467, 6.32201, 11.73622,
        13.06006, 3.74345, 4.9373, 7.28455, 8.90334, 11.33152, 9.86449,
        4.04697, 5.26106, 11.07399, 7.28455, 5.13173, 11.33152, 2.93405,
        8.66052, 6.72705, 2.76543, 218.03325, 30.3523, 23.03095, 11.55227,
        8.88089, 3.37247, 2.18536, 2.17524, 7.38572, 2.89069, 3.50737, 3.64227,
        3.22139, 3.12195, 8.90334, 3.91207, 43.99865, 17.65578, 5.8392,
        11.26905, 4.24932, 2.14489, 14.27604, 12.67801, 6.27863, 3.3808,
        9.28379, 5.47368, 6.7616, 6.43962, 8.63983, 19.81925, 11.755, 2.65634,
        5.01083, 8.09792, 4.226, 5.1517, 16.39522, 14.79535, 6.7616, 5.65767};
    //}}}

    char *file_name = "../data/many/2.1.bed.gz";
    struct input_file *i = input_file_init(file_name);

    int chrm_len = 10;
    char *chrm = (char *)malloc(chrm_len*sizeof(char));
    uint32_t start, end;
    long offset;
    kstring_t line = {0, 0, NULL};

    offset_data_size =
            sizeof(struct offset_data_append_data_test_struct_larger);
    offset_data_append_data = offset_data_append_data_test_func_larger;

    struct offset_index *offset_idx = 
            offset_index_init(100,
                              "tmp.test_offset_index_add");
    TEST_ASSERT_EQUAL(on_disk, offset_idx->type);
    uint32_t intrv_id;

    while (i->input_file_get_next_interval(i,
                                           &chrm,
                                           &chrm_len,
                                           &start,
                                           &end,
                                           &offset,
                                           &line) >= 0) {
        intrv_id = offset_index_add(offset_idx,
                                    offset,
                                    &line,
                                    1);

    }

    TEST_ASSERT_EQUAL(1000, offset_idx->index->num);
    
    uint32_t j;
    char A_concat[20];
    for (j = 0; j < 1000; ++j) {
        TEST_ASSERT_EQUAL(A_offsets[j], 
                          OFFSET_INDEX_PAIR(offset_idx, j)->offset);
        struct offset_data_append_data_test_struct_larger *tmp;
        tmp = (struct offset_data_append_data_test_struct_larger *)
                OFFSET_INDEX_DATA(offset_idx, j);
        TEST_ASSERT_EQUAL(A_data[j], tmp->uint);
        TEST_ASSERT_EQUAL(A_flt[j], tmp->flt);
        int ret = sprintf(A_concat, "%u %.6f", tmp->uint,  tmp->flt);
        TEST_ASSERT_EQUAL(0, strcmp(A_concat, tmp->concat));
    }

    if (line.s != NULL)
        free(line.s);
    input_file_destroy(&i);
    offset_index_destroy(&offset_idx);
    free(chrm);
}
//}}}

//{{{ void test_offset_index_store_load_data(void)
void test_offset_index_store_load_data(void)
{ 
    //{{{ uint32_t A_offsets[1000] = 
    uint32_t A_offsets[1000] = {0, 61, 118, 173, 230, 292, 350, 412, 476, 534,
        599, 661, 726, 784, 841, 899, 964, 1026, 1085, 1145, 1204, 1267, 1330,
        1388, 1447, 1508, 1566, 1627, 1686, 1747, 1810, 1873, 1935, 1992, 2050,
        2108, 2167, 2226, 2285, 2344, 2401, 2460, 2519, 2578, 2636, 2702, 2766,
        2826, 2886, 2947, 3009, 3069, 3128, 3188, 3248, 3312, 3375, 3441, 3499,
        3559, 3622, 3683, 3746, 3804, 3863, 3922, 3983, 4043, 4104, 4164, 4225,
        4285, 4352, 4413, 4480, 4544, 4607, 4668, 4729, 4792, 4853, 4917, 4978,
        5037, 5101, 5161, 5218, 5285, 5346, 5409, 5465, 5526, 5583, 5645, 5706,
        5767, 5827, 5887, 5950, 6010, 6069, 6133, 6193, 6254, 6316, 6375, 6435,
        6494, 6557, 6616, 6676, 6736, 6796, 6855, 6915, 6975, 7033, 7092, 7158,
        7218, 7277, 7337, 7397, 7455, 7518, 7577, 7637, 7701, 7761, 7822, 7885,
        7951, 8016, 8078, 8140, 8202, 8264, 8326, 8388, 8453, 8513, 8575, 8636,
        8698, 8752, 8810, 8868, 8926, 8985, 9043, 9103, 9162, 9222, 9282, 9341,
        9401, 9461, 9524, 9583, 9641, 9700, 9762, 9822, 9882, 9945, 10008,
        10065, 10128, 10188, 10248, 10308, 10370, 10427, 10487, 10547, 10606,
        10665, 10726, 10788, 10853, 10914, 10976, 11039, 11104, 11168, 11229,
        11291, 11355, 11413, 11470, 11525, 11584, 11641, 11698, 11755, 11815,
        11877, 11936, 11999, 12058, 12120, 12184, 12244, 12304, 12364, 12427,
        12491, 12549, 12610, 12674, 12738, 12803, 12869, 12929, 12990, 13049,
        13111, 13171, 13233, 13296, 13356, 13416, 13480, 13539, 13599, 13663,
        13725, 13787, 13851, 13913, 13978, 14044, 14105, 14166, 14226, 14288,
        14351, 14411, 14471, 14530, 14589, 14651, 14715, 14773, 14832, 14893,
        14957, 15016, 15075, 15135, 15194, 15253, 15313, 15373, 15432, 15491,
        15550, 15610, 15670, 15731, 15790, 15848, 15910, 15970, 16033, 16092,
        16156, 16216, 16276, 16335, 16392, 16452, 16511, 16569, 16628, 16686,
        16746, 16804, 16870, 16932, 16993, 17055, 17116, 17176, 17235, 17297,
        17357, 17415, 17474, 17537, 17596, 17656, 17717, 17779, 17839, 17899,
        17958, 18018, 18079, 18138, 18200, 18259, 18317, 18376, 18439, 18503,
        18566, 18625, 18687, 18748, 18808, 18870, 18931, 18991, 19054, 19115,
        19175, 19234, 19296, 19358, 19417, 19475, 19536, 19596, 19658, 19716,
        19776, 19837, 19899, 19958, 20016, 20073, 20137, 20203, 20262, 20321,
        20382, 20441, 20504, 20564, 20629, 20688, 20747, 20806, 20865, 20923,
        20982, 21041, 21103, 21164, 21222, 21285, 21341, 21398, 21457, 21516,
        21575, 21634, 21694, 21757, 21822, 21881, 21941, 22000, 22059, 22123,
        22181, 22239, 22297, 22355, 22411, 22470, 22531, 22595, 22654, 22715,
        22778, 22839, 22898, 22956, 23016, 23080, 23140, 23199, 23259, 23319,
        23382, 23445, 23504, 23564, 23626, 23693, 23757, 23816, 23876, 23936,
        23996, 24055, 24113, 24172, 24232, 24293, 24353, 24415, 24474, 24536,
        24594, 24653, 24712, 24776, 24840, 24896, 24956, 25012, 25069, 25128,
        25184, 25244, 25303, 25364, 25424, 25487, 25546, 25606, 25664, 25722,
        25784, 25843, 25902, 25962, 26021, 26079, 26138, 26200, 26259, 26321,
        26382, 26443, 26505, 26563, 26620, 26682, 26738, 26798, 26856, 26915,
        26975, 27036, 27098, 27158, 27221, 27283, 27343, 27406, 27466, 27525,
        27587, 27646, 27705, 27767, 27828, 27887, 27947, 28006, 28065, 28131,
        28191, 28254, 28314, 28372, 28431, 28491, 28551, 28615, 28681, 28741,
        28800, 28859, 28919, 28978, 29038, 29104, 29165, 29225, 29287, 29344,
        29401, 29458, 29519, 29578, 29636, 29695, 29754, 29812, 29871, 29934,
        29996, 30057, 30116, 30174, 30233, 30291, 30352, 30411, 30473, 30531,
        30592, 30652, 30716, 30775, 30834, 30896, 30959, 31016, 31074, 31133,
        31194, 31254, 31317, 31376, 31436, 31497, 31558, 31618, 31678, 31739,
        31802, 31865, 31928, 31988, 32048, 32106, 32167, 32231, 32290, 32355,
        32414, 32474, 32534, 32599, 32660, 32721, 32781, 32842, 32905, 32966,
        33027, 33090, 33151, 33213, 33278, 33338, 33399, 33460, 33520, 33578,
        33639, 33699, 33759, 33819, 33878, 33941, 34001, 34065, 34125, 34185,
        34245, 34304, 34362, 34421, 34487, 34546, 34605, 34664, 34724, 34787,
        34846, 34905, 34967, 35027, 35089, 35148, 35207, 35267, 35329, 35389,
        35451, 35511, 35570, 35630, 35691, 35755, 35814, 35873, 35935, 35998,
        36064, 36124, 36183, 36247, 36310, 36369, 36430, 36489, 36551, 36611,
        36670, 36730, 36790, 36850, 36914, 36974, 37033, 37093, 37152, 37210,
        37269, 37327, 37390, 37455, 37512, 37571, 37631, 37687, 37743, 37806,
        37864, 37922, 37985, 38043, 38102, 38164, 38223, 38280, 38341, 38399,
        38461, 38522, 38583, 38642, 38700, 38760, 38822, 38882, 38940, 38999,
        39064, 39124, 39185, 39248, 39309, 39369, 39434, 39495, 39556, 39616,
        39680, 39741, 39802, 39862, 39925, 39990, 40052, 40116, 40177, 40237,
        40298, 40359, 40418, 40479, 40540, 40599, 40665, 40726, 40787, 40850,
        40914, 40970, 41027, 41085, 41141, 41202, 41260, 41322, 41379, 41438,
        41498, 41552, 41614, 41677, 41738, 41797, 41860, 41918, 41975, 42032,
        42091, 42150, 42209, 42267, 42329, 42387, 42448, 42509, 42569, 42630,
        42690, 42751, 42814, 42874, 42934, 42995, 43059, 43119, 43182, 43245,
        43304, 43366, 43430, 43486, 43544, 43602, 43661, 43718, 43777, 43836,
        43895, 43953, 44014, 44073, 44132, 44190, 44249, 44312, 44369, 44431,
        44489, 44548, 44609, 44674, 44735, 44797, 44858, 44919, 44984, 45045,
        45103, 45168, 45228, 45290, 45349, 45412, 45475, 45538, 45598, 45659,
        45719, 45784, 45847, 45910, 45971, 46032, 46093, 46157, 46218, 46280,
        46344, 46405, 46465, 46526, 46590, 46650, 46714, 46774, 46833, 46893,
        46953, 47017, 47077, 47131, 47186, 47245, 47305, 47361, 47420, 47476,
        47533, 47588, 47647, 47706, 47765, 47824, 47883, 47942, 48003, 48061,
        48121, 48180, 48239, 48298, 48360, 48422, 48478, 48536, 48598, 48663,
        48724, 48785, 48844, 48908, 48967, 49026, 49086, 49145, 49204, 49263,
        49325, 49383, 49443, 49506, 49570, 49630, 49691, 49751, 49812, 49873,
        49933, 49996, 50063, 50127, 50188, 50249, 50309, 50370, 50430, 50490,
        50551, 50605, 50658, 50712, 50769, 50827, 50887, 50943, 51003, 51066,
        51125, 51183, 51242, 51303, 51361, 51419, 51481, 51539, 51598, 51657,
        51715, 51778, 51836, 51894, 51955, 52013, 52074, 52137, 52201, 52265,
        52325, 52387, 52451, 52515, 52574, 52641, 52701, 52764, 52824, 52884,
        52947, 53006, 53070, 53131, 53192, 53254, 53314, 53376, 53439, 53498,
        53556, 53617, 53682, 53745, 53806, 53866, 53925, 53987, 54048, 54108,
        54169, 54232, 54297, 54356, 54413, 54468, 54525, 54588, 54646, 54704,
        54766, 54829, 54890, 54949, 55012, 55072, 55129, 55187, 55250, 55307,
        55365, 55423, 55482, 55540, 55598, 55659, 55716, 55775, 55833, 55890,
        55948, 56006, 56071, 56133, 56194, 56254, 56314, 56374, 56435, 56496,
        56560, 56621, 56681, 56742, 56800, 56863, 56926, 56985, 57043, 57101,
        57163, 57223, 57285, 57342, 57403, 57466, 57523, 57581, 57641, 57698,
        57759, 57820, 57879, 57937, 57998, 58063, 58126, 58183, 58244, 58305,
        58365, 58428, 58489, 58549, 58610, 58672, 58733, 58793, 58853, 58918,
        58982, 59044, 59104, 59164, 59225, 59286, 59347, 59404, 59460, 59522,
        59581, 59637, 59698, 59760, 59823, 59883, 59944, 60007, 60068, 60127,
        60187, 60249, 60310, 60372};
    //}}}

    //{{{uint32_t A_data[1000] = 
    uint32_t A_data[1000] = {1000, 453, 421, 506, 1000, 426, 1000, 1000, 531,
        1000, 1000, 1000, 490, 397, 497, 1000, 1000, 606, 680, 604, 1000, 1000,
        534, 482, 692, 448, 893, 494, 670, 1000, 1000, 1000, 487, 565, 472,
        427, 613, 552, 577, 371, 638, 422, 478, 397, 1000, 1000, 459, 429, 603,
        630, 429, 426, 443, 380, 752, 768, 1000, 440, 422, 933, 537, 876, 386,
        415, 379, 481, 415, 556, 409, 579, 473, 1000, 442, 1000, 1000, 905,
        496, 392, 856, 489, 1000, 427, 415, 1000, 382, 408, 1000, 523, 973,
        408, 1000, 453, 1000, 1000, 1000, 545, 517, 1000, 402, 370, 1000, 495,
        945, 1000, 482, 430, 414, 1000, 465, 581, 499, 375, 468, 501, 538, 378,
        443, 1000, 490, 524, 477, 517, 437, 1000, 397, 370, 1000, 416, 473,
        993, 1000, 801, 592, 535, 433, 531, 386, 393, 1000, 385, 385, 378, 403,
        388, 918, 1000, 956, 795, 408, 488, 378, 464, 418, 595, 502, 459, 919,
        596, 385, 448, 931, 617, 497, 772, 754, 385, 1000, 646, 441, 515, 712,
        379, 410, 597, 371, 420, 872, 719, 1000, 410, 410, 973, 1000, 732, 403,
        470, 719, 1000, 400, 436, 552, 386, 389, 393, 373, 788, 371, 1000, 397,
        896, 1000, 380, 526, 372, 937, 1000, 373, 964, 1000, 1000, 1000, 1000,
        419, 689, 373, 888, 406, 1000, 1000, 423, 592, 1000, 423, 523, 995,
        383, 473, 795, 472, 654, 1000, 391, 402, 407, 461, 1000, 395, 424, 407,
        378, 872, 1000, 378, 479, 503, 1000, 400, 380, 380, 389, 370, 509, 371,
        393, 378, 444, 436, 478, 424, 383, 393, 986, 472, 1000, 483, 1000, 380,
        373, 516, 371, 481, 380, 407, 430, 378, 580, 373, 1000, 502, 415, 419,
        380, 483, 382, 656, 517, 423, 391, 692, 395, 538, 699, 706, 422, 405,
        372, 569, 841, 508, 1000, 436, 424, 439, 1000, 1000, 1000, 424, 785,
        646, 580, 724, 640, 427, 1000, 1000, 448, 466, 554, 422, 1000, 772,
        717, 744, 1000, 578, 499, 914, 694, 380, 402, 393, 1000, 1000, 461,
        380, 646, 490, 1000, 495, 1000, 525, 436, 414, 393, 371, 509, 530, 668,
        643, 375, 756, 393, 491, 490, 493, 408, 524, 567, 1000, 1000, 556, 511,
        452, 465, 1000, 396, 375, 511, 371, 489, 432, 1000, 1000, 400, 708,
        1000, 672, 380, 440, 391, 1000, 433, 375, 950, 483, 1000, 1000, 461,
        625, 974, 1000, 1000, 430, 575, 433, 545, 415, 380, 470, 580, 642, 460,
        896, 403, 754, 564, 392, 430, 1000, 1000, 370, 741, 603, 410, 643, 515,
        371, 622, 644, 505, 1000, 375, 437, 380, 400, 706, 487, 525, 389, 393,
        378, 389, 978, 386, 1000, 1000, 882, 1000, 547, 400, 1000, 370, 829,
        494, 749, 610, 906, 1000, 403, 1000, 744, 423, 1000, 432, 617, 833,
        502, 380, 996, 589, 429, 525, 416, 430, 1000, 403, 1000, 397, 381, 749,
        432, 539, 1000, 1000, 484, 558, 422, 399, 516, 480, 1000, 684, 594,
        677, 424, 432, 443, 864, 509, 371, 547, 501, 428, 580, 1000, 1000, 689,
        391, 618, 524, 482, 682, 624, 1000, 436, 742, 499, 1000, 458, 397,
        1000, 1000, 406, 375, 407, 661, 592, 662, 436, 378, 465, 508, 429, 473,
        380, 882, 623, 1000, 409, 508, 584, 511, 1000, 375, 1000, 373, 501,
        381, 1000, 493, 440, 494, 413, 757, 624, 491, 734, 413, 863, 1000, 397,
        389, 386, 371, 876, 1000, 819, 460, 422, 407, 1000, 497, 1000, 432,
        400, 422, 399, 510, 466, 1000, 436, 573, 381, 376, 1000, 578, 419, 719,
        482, 656, 390, 388, 511, 843, 426, 723, 538, 372, 400, 884, 1000, 415,
        450, 681, 656, 1000, 497, 425, 1000, 1000, 444, 820, 450, 816, 431,
        399, 370, 394, 387, 1000, 625, 385, 524, 422, 385, 387, 403, 1000,
        1000, 593, 1000, 1000, 530, 458, 1000, 472, 436, 1000, 441, 456, 1000,
        449, 394, 786, 391, 1000, 1000, 706, 383, 375, 517, 1000, 592, 422,
        501, 1000, 429, 449, 1000, 386, 591, 1000, 590, 591, 371, 876, 415,
        389, 375, 1000, 1000, 795, 1000, 472, 401, 451, 392, 469, 493, 437,
        415, 1000, 430, 554, 952, 1000, 442, 620, 634, 440, 1000, 800, 1000,
        378, 441, 617, 373, 1000, 1000, 1000, 442, 1000, 530, 436, 499, 503,
        597, 523, 444, 1000, 544, 691, 737, 390, 452, 385, 397, 809, 400, 380,
        499, 846, 501, 1000, 809, 371, 640, 1000, 377, 415, 383, 524, 371, 400,
        479, 389, 508, 985, 410, 486, 380, 423, 1000, 499, 1000, 409, 382, 436,
        1000, 382, 660, 592, 420, 1000, 380, 389, 1000, 400, 759, 436, 808,
        1000, 1000, 410, 415, 400, 1000, 1000, 703, 482, 646, 400, 938, 475,
        651, 1000, 482, 596, 624, 1000, 416, 1000, 424, 373, 371, 483, 809,
        444, 415, 390, 1000, 1000, 495, 857, 436, 445, 383, 432, 553, 621, 375,
        460, 473, 748, 566, 632, 484, 504, 520, 1000, 1000, 380, 371, 1000,
        1000, 1000, 914, 813, 1000, 467, 409, 797, 400, 515, 581, 1000, 524,
        400, 821, 1000, 489, 490, 432, 524, 444, 559, 1000, 1000, 1000, 376,
        593, 470, 468, 375, 395, 451, 422, 375, 389, 521, 751, 745, 443, 849,
        1000, 489, 394, 445, 713, 530, 407, 1000, 503, 519, 402, 382, 1000,
        385, 389, 901, 444, 731, 877, 1000, 1000, 525, 636, 1000, 1000, 439,
        1000, 591, 754, 422, 489, 846, 378, 1000, 533, 533, 1000, 370, 631,
        1000, 382, 378, 422, 1000, 669, 1000, 407, 403, 1000, 524, 372, 504,
        994, 1000, 1000, 425, 373, 371, 1000, 432, 393, 1000, 1000, 660, 592,
        1000, 769, 493, 400, 1000, 406, 393, 372, 385, 593, 393, 762, 482, 425,
        416, 378, 371, 440, 1000, 684, 438, 380, 380, 385, 471, 581, 1000, 552,
        424, 386, 459, 1000, 1000, 438, 566, 597, 1000, 482, 1000, 372, 897,
        1000, 400, 407, 482, 534, 940, 686, 411, 424, 921, 1000, 1000, 465,
        464, 400, 383, 714, 434, 391, 513, 884, 457, 432, 517, 1000, 773, 791,
        525, 393, 396, 461, 1000, 429, 371, 1000, 458, 371, 713, 1000, 1000,
        763, 436, 668, 609, 437, 443, 543, 616, 670, 694};
    //}}}

    //{{{float A_flt[1000] = {
    float A_flt[1000] = { 12.12021, 3.88225, 3.4088, 14.7654, 3.48997, 1.87484,
        6.77027, 11.9687, 3.91381, 14.51326, 15.4361, 70.82748, 10.98394,
        3.4088, 7.00699, 14.99353, 6.74875, 3.70339, 5.9086, 9.46891, 11.11019,
        12.83984, 2.98867, 10.60518, 3.52535, 9.09015, 6.88074, 5.51758,
        6.57388, 9.72435, 19.31658, 8.55989, 4.3557, 3.29518, 3.34568,
        14.73803, 3.03005, 3.24808, 3.78756, 5.30259, 7.87982, 5.11321,
        2.65129, 703.58101, 16.76629, 9.75298, 6.42889, 5.30259, 4.22043,
        10.03705, 4.74661, 3.18155, 4.29257, 2.21843, 18.93783, 2.25607,
        221.42388, 8.7114, 5.11321, 5.26471, 7.95388, 8.08975, 7.6656, 3.31412,
        3.03005, 2.86171, 7.21588, 6.18635, 3.21943, 3.32893, 9.87197,
        15.46589, 3.03005, 12.27171, 17.15226, 7.70302, 2.27253, 2.46191,
        4.22459, 3.93906, 5.11321, 3.50349, 5.51496, 18.43282, 2.33566,
        7.19637, 19.94784, 4.31782, 3.47468, 8.91237, 55.35055, 8.03434,
        24.23541, 7.40464, 5.32535, 4.15464, 35.09704, 7.00258, 4.06529,
        2.34536, 23.12527, 3.14278, 9.09766, 7.56379, 3.40077, 7.28391,
        5.62886, 9.42185, 5.47251, 4.92526, 3.02764, 2.27835, 3.6744, 3.57667,
        3.47113, 7.03608, 5.59169, 17.01169, 3.61855, 8.00551, 3.48453,
        5.54992, 4.10438, 6.30188, 45.08121, 2.34536, 34.71985, 9.38144,
        12.66495, 11.96134, 31.76898, 11.72681, 7.97423, 6.87972, 3.56495,
        5.62886, 4.69072, 4.92526, 6.09794, 7.27949, 2.81443, 7.03608, 3.09587,
        4.29351, 7.28596, 9.12913, 14.21216, 7.02574, 4.87899, 30.27434,
        5.85479, 2.81897, 2.62071, 3.51287, 5.46447, 2.43949, 11.94931,
        5.07415, 6.2451, 2.68886, 5.07415, 4.34927, 15.91178, 13.46601,
        13.07569, 6.2451, 12.33409, 4.57231, 2.73223, 4.87899, 3.51287,
        3.12255, 3.77308, 3.95198, 5.46447, 2.17928, 9.1725, 8.49777, 9.98567,
        3.77308, 3.77308, 4.7739, 5.04813, 9.10745, 3.22013, 7.32016, 8.56192,
        278.95909, 4.47425, 4.47425, 14.64303, 4.0675, 74.15807, 4.27088,
        3.66075, 9.23069, 5.69451, 6.72335, 3.66075, 3.84153, 26.57438,
        25.86841, 2.63032, 2.64388, 12.60927, 25.57446, 2.03375, 7.79605,
        16.21919, 15.89002, 19.9522, 28.35634, 3.45738, 4.37627, 3.66075,
        7.18593, 711.99196, 8.13501, 7.10458, 4.20309, 5.89788, 11.72182,
        2.59303, 5.28467, 4.76479, 2.32429, 2.93764, 5.38944, 4.27088,
        10.77889, 10.98227, 3.52517, 2.55671, 3.254, 20.84931, 20.3708,
        3.18293, 3.18293, 4.8805, 8.27563, 7.35612, 24.57228, 8.27563,
        17.58992, 10.50369, 10.82198, 4.6683, 4.03172, 2.63729, 3.81952,
        7.63905, 5.38724, 1.66492, 4.45611, 8.27563, 5.94148, 12.73175,
        9.54881, 120.4028, 2.84145, 6.90067, 4.38903, 5.14167, 8.64033,
        6.69771, 6.37121, 2.36787, 1.76866, 7.50955, 5.6829, 6.73498, 3.85625,
        2.60949, 6.33298, 6.08882, 7.03598, 3.65329, 16.10157, 4.22158,
        20.45145, 3.45033, 3.85625, 6.81006, 2.65302, 7.06046, 6.27596, 4.4217,
        3.70852, 11.79783, 2.50631, 2.46046, 12.4093, 8.80896, 5.72578,
        2.46046, 2.78139, 5.88372, 6.4186, 7.70232, 6.2211, 4.70697, 8.98604,
        2.11436, 6.97488, 13.93754, 9.41395, 28.7183, 5.99069, 4.27906,
        7.41705, 6.76093, 3.97953, 2.37293, 6.10739, 6.4186, 8.49451, 1.9652,
        3.79767, 2.43906, 8.59356, 13.44763, 14.87347, 9.17197, 14.74953,
        6.69306, 2.89842, 8.59356, 7.23842, 4.70993, 4.29678, 8.4283, 12.27062,
        14.30332, 7.50125, 2.25856, 4.36288, 3.8246, 6.66552, 4.21415,
        132.01495, 16.36082, 5.12308, 5.94939, 5.20571, 6.94095, 6.02564,
        4.6273, 9.91565, 7.68463, 3.09864, 11.56826, 8.4283, 8.4283, 14.37769,
        3.59442, 7.65796, 4.17873, 5.65192, 7.84238, 10.78327, 3.71836,
        6.77569, 7.18884, 5.78413, 10.23115, 2.77158, 2.45482, 3.89341,
        1.40558, 6.64682, 10.11018, 8.14505, 24.74626, 8.89158, 3.40508,
        7.80002, 8.41589, 2.87056, 9.10662, 3.06853, 14.19728, 23.05476,
        2.77158, 5.50356, 1.93874, 8.97464, 4.89715, 2.34735, 4.20686, 8.78987,
        32.86303, 15.93659, 3.2467, 3.01523, 3.76143, 2.69239, 5.14722,
        2.53401, 14.9326, 4.55331, 5.62235, 3.36549, 5.22641, 3.2665, 6.73098,
        6.599, 2.57361, 3.03554, 12.67008, 13.46196, 2.33794, 6.00072, 4.25505,
        2.56394, 3.19129, 4.546, 2.12752, 5.81888, 12.42236, 2.58404, 7.85549,
        3.6368, 4.50054, 2.63668, 5.4552, 7.85549, 5.4552, 12.73173, 17.79964,
        5.18244, 7.09176, 3.16401, 17.89681, 7.63728, 23.66953, 7.53271,
        13.70596, 15.50422, 6.09442, 6.58198, 13.31022, 2.92532, 4.91617,
        8.07562, 6.985, 7.06953, 6.26855, 10.6043, 3.01674, 5.53584, 9.01975,
        2.66413, 7.77039, 3.14472, 7.7539, 8.19699, 3.94918, 4.17865, 4.87554,
        20.61221, 5.11931, 3.83948, 7.31331, 7.93728, 17.58677, 2.77905,
        12.70687, 2.40294, 3.83948, 5.22379, 3.14472, 3.96137, 12.43263,
        47.90219, 2.74249, 8.9588, 4.93648, 1.98068, 5.60687, 4.11373,
        27.75734, 5.18026, 3.57539, 9.53361, 3.88196, 2.63503, 2.72913,
        12.16264, 5.29359, 3.29378, 5.62242, 4.51719, 2.95768, 3.59322,
        27.57372, 6.74442, 6.03861, 2.91735, 7.1355, 8.94028, 3.41142, 4.75769,
        2.91735, 9.81469, 4.86226, 5.17595, 14.11624, 34.34951, 2.62718,
        941.31799, 4.42308, 10.56239, 6.58757, 2.43113, 1.42451, 4.10654,
        10.82245, 3.92117, 6.3523, 7.05812, 5.48964, 4.73982, 6.11703, 6.65148,
        18.89433, 356.30091, 293.75971, 10.60102, 4.23487, 4.6113, 7.8496,
        6.43073, 10.19506, 2.94088, 23.91918, 3.24673, 3.58787, 4.00325,
        10.19506, 2.99435, 3.67022, 5.05831, 2.70561, 5.28051, 4.33943,
        2.86245, 5.12367, 2.70561, 31.8797, 14.78844, 92.30747, 610.58464,
        4.70541, 3.29378, 8.28664, 6.62077, 4.44232, 3.75888, 6.87706, 5.86581,
        6.50748, 3.75888, 16.42786, 2.32367, 2.08447, 2.93876, 2.90459,
        3.89557, 5.63833, 14.66536, 4.9549, 4.51066, 3.58803, 2.00758, 6.05807,
        2.26387, 2.4399, 3.31953, 2.78779, 5.70311, 2.5287, 2.73373, 2.38517,
        9.71738, 3.09189, 5.55278, 3.97529, 2.35572, 2.25266, 8.6573, 17.99924,
        6.52081, 4.85869, 7.15639, 10.11753, 46.59926, 22.22549, 3.86486,
        62.05873, 6.65638, 2.88552, 8.07947, 2.93799, 3.23178, 1.65818,
        3.55007, 2.09856, 4.22336, 3.30523, 17.87277, 5.21493, 5.87598,
        8.53824, 4.95785, 5.87598, 2.57074, 3.0298, 10.7948, 12.87665, 3.38472,
        6.62337, 6.41995, 3.47825, 2.89037, 10.73001, 5.19463, 2.69441,
        16.18051, 2.7434, 2.38164, 3.65484, 3.44885, 4.50702, 3.03308, 3.03048,
        6.58418, 8.08771, 3.28229, 2.23951, 3.91915, 11.88933, 5.29086,
        10.25454, 3.40792, 4.70298, 14.73023, 5.40111, 3.44885, 5.91792,
        13.13354, 2.76646, 14.78081, 12.97096, 2.64027, 5.48681, 10.09529,
        17.67994, 13.15142, 3.91915, 4.74909, 12.23336, 7.05448, 5.74809,
        4.96426, 2.82179, 2.65631, 2.35149, 2.98835, 3.18431, 2.46906, 5.0949,
        44.87433, 4.18043, 8.62214, 6.27064, 5.13025, 2.80661, 3.43829,
        5.56028, 10.8051, 22.24113, 12.43104, 6.72841, 7.14893, 3.60658,
        11.96839, 4.28936, 7.14893, 11.98298, 7.6851, 2.26383, 9.27773,
        4.95659, 2.62127, 7.90684, 6.35461, 5.41946, 4.21893, 6.67234, 9.87853,
        4.60709, 5.16776, 5.48085, 2.10496, 6.91063, 2.3234, 3.05021, 6.01702,
        5.07265, 4.52766, 8.34042, 12.54419, 4.57531, 6.08227, 6.01702, 4.7149,
        5.10638, 3.61955, 3.25597, 2.95997, 3.10797, 3.10797, 6.21595, 2.08336,
        4.77296, 1.62798, 4.52876, 7.61137, 3.19677, 4.88396, 93.19067,
        4.23694, 4.27716, 7.57789, 5.18921, 3.99597, 2.34683, 4.58796,
        12.93933, 2.51598, 9.19883, 7.54794, 3.03397, 11.91391, 15.83552,
        66.766, 4.46463, 4.88396, 6.51195, 4.58796, 8.73091, 6.13001, 8.6826,
        2.35318, 166.66526, 7.99194, 10.65592, 7.2654, 6.87075, 10.34996,
        4.3413, 2.49748, 14.62498, 3.05864, 8.58393, 7.07782, 3.77397, 4.27346,
        6.88194, 6.90661, 8.87993, 9.19961, 9.32393, 3.99597, 3.10797, 3.32997,
        15.53988, 6.21595, 22.91597, 1.75206, 6.51226, 4.33224, 2.9566,
        4.07902, 4.87641, 2.58703, 3.77788, 2.62809, 2.37258, 2.60984, 2.54596,
        3.96007, 2.66459, 2.87447, 5.0098, 4.12986, 2.73759, 2.54596, 11.49791,
        6.67973, 3.92785, 2.20943, 3.44937, 6.33906, 10.21515, 7.68677,
        5.46142, 5.831, 6.92731, 2.00565, 1.74629, 2.80603, 2.21745, 5.25618,
        4.37766, 5.34069, 7.9774, 5.95029, 4.92767, 4.91707, 2.0921, 1.92053,
        3.94214, 3.16192, 1.82823, 4.92767, 7.30306, 12.37394, 5.09193,
        1.66445, 2.57012, 9.52684, 3.86001, 2.54596, 3.28511, 4.95543, 5.96741,
        3.45937, 3.00965, 6.91874, 6.44925, 15.56717, 4.4107, 20.14233,
        50.63039, 3.85473, 3.97827, 3.94368, 5.24671, 4.2995, 5.44851,
        10.41518, 2.76749, 6.61812, 2.35866, 2.5204, 10.63757, 4.67015,
        625.8006, 7.78358, 3.33582, 3.66116, 23.55738, 7.00523, 20.11554,
        5.83769, 3.63234, 9.50246, 7.13495, 2.80209, 5.30362, 3.8682, 4.26244,
        2.54735, 3.85473, 8.98668, 4.4107, 5.88093, 3.80531, 3.80531, 4.874,
        1.72968, 4.61249, 6.14903, 2.5204, 4.4107, 6.72949, 15.48069, 5.25392,
        9.643, 2.33507, 3.63234, 5.86931, 3.95665, 4.15124, 3.37288, 4.24559,
        13.07643, 8.1283, 3.68784, 3.7932, 5.90054, 32.52693, 3.7932, 7.16494,
        7.52157, 10.26848, 4.53077, 6.11127, 16.12113, 5.86378, 3.49215,
        4.63614, 11.41474, 2.80978, 2.03709, 2.44451, 1.79123, 3.33661,
        7.16494, 9.31376, 3.8803, 3.68784, 3.11885, 2.8449, 5.90054, 9.69375,
        15.1404, 5.11781, 3.89857, 92.81556, 4.00394, 3.51222, 2.46859,
        4.27488, 5.77878, 5.00768, 8.19586, 4.21467, 6.32201, 11.73622,
        13.06006, 3.74345, 4.9373, 7.28455, 8.90334, 11.33152, 9.86449,
        4.04697, 5.26106, 11.07399, 7.28455, 5.13173, 11.33152, 2.93405,
        8.66052, 6.72705, 2.76543, 218.03325, 30.3523, 23.03095, 11.55227,
        8.88089, 3.37247, 2.18536, 2.17524, 7.38572, 2.89069, 3.50737, 3.64227,
        3.22139, 3.12195, 8.90334, 3.91207, 43.99865, 17.65578, 5.8392,
        11.26905, 4.24932, 2.14489, 14.27604, 12.67801, 6.27863, 3.3808,
        9.28379, 5.47368, 6.7616, 6.43962, 8.63983, 19.81925, 11.755, 2.65634,
        5.01083, 8.09792, 4.226, 5.1517, 16.39522, 14.79535, 6.7616, 5.65767};
    //}}}

    char *file_name = "../data/many/2.1.bed.gz";
    struct input_file *i = input_file_init(file_name);

    int chrm_len = 10;
    char *chrm = (char *)malloc(chrm_len*sizeof(char));
    uint32_t start, end;
    long offset;
    kstring_t line = {0, 0, NULL};

    offset_data_size =
            sizeof(struct offset_data_append_data_test_struct_larger);
    offset_data_append_data = offset_data_append_data_test_func_larger;

    struct offset_index *offset_idx = 
            offset_index_init(10,
                              "tmp.test_offset_index_add");
    TEST_ASSERT_EQUAL(on_disk, offset_idx->type);
    uint32_t intrv_id;

    while (i->input_file_get_next_interval(i,
                                           &chrm,
                                           &chrm_len,
                                           &start,
                                           &end,
                                           &offset,
                                           &line) >= 0) {
        intrv_id = offset_index_add(offset_idx,
                                    offset,
                                    &line,
                                    1);

    }

    TEST_ASSERT_EQUAL(1000, offset_idx->index->num);
    
    uint32_t j;
    char A_concat[20];
    for (j = 0; j < 1000; ++j) {
        TEST_ASSERT_EQUAL(A_offsets[j], 
                          OFFSET_INDEX_PAIR(offset_idx, j)->offset);
        struct offset_data_append_data_test_struct_larger *tmp;
        tmp = (struct offset_data_append_data_test_struct_larger *)
                OFFSET_INDEX_DATA(offset_idx, j);
        TEST_ASSERT_EQUAL(A_data[j], tmp->uint);
        TEST_ASSERT_EQUAL(A_flt[j], tmp->flt);
        int ret = sprintf(A_concat, "%u %.6f", tmp->uint,  tmp->flt);
        TEST_ASSERT_EQUAL(0, strcmp(A_concat, tmp->concat));
    }

    if (line.s != NULL)
        free(line.s);
    input_file_destroy(&i);

    offset_index_store(offset_idx);

    offset_index_destroy(&offset_idx);
    free(chrm);

    offset_idx = offset_index_load("tmp.test_offset_index_add");
    TEST_ASSERT_EQUAL(on_disk, offset_idx->type);

    for (j = 0; j < 1000; ++j) {
        TEST_ASSERT_EQUAL(A_offsets[j], 
                          OFFSET_INDEX_PAIR(offset_idx, j)->offset);
        struct offset_data_append_data_test_struct_larger *tmp;
        tmp = (struct offset_data_append_data_test_struct_larger *)
                OFFSET_INDEX_DATA(offset_idx, j);
        TEST_ASSERT_EQUAL(A_data[j], tmp->uint);
        TEST_ASSERT_EQUAL(A_flt[j], tmp->flt);
        int ret = sprintf(A_concat, "%u %.6f", tmp->uint,  tmp->flt);
        TEST_ASSERT_EQUAL(0, strcmp(A_concat, tmp->concat));
    }

    offset_index_destroy(&offset_idx);

    remove("tmp.test_offset_index_add");
}
//}}}

